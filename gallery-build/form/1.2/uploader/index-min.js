KISSY.add("gallery/form/1.2/uploader/auth/base",function(f,d,e){var h="",g=d.all,b=b||f,a="[uploader-auth]:";function c(k,j){var i=this;j=f.merge({uploader:k},j);c.superclass.constructor.call(i,j);i._init()}f.mix(c,{event:{ERROR:"error"}});f.extend(c,e,{_init:function(){var j=this,k=j.get("uploader"),i=k.get("queue");if(k==h){b.log(a+"uploader不可以为空！");return false}j._setSwfButtonExt();i.on("add",function(m){var l=m.file;j.testAllowExt(l);j.testMaxSize(l);j.testRepeat(l)});i.on("remove",function(n){var m=n.file,l=m.status;if(l=="success"){j.testMax()}});k.on("success",function(l){j.testMax()});k.on("error",function(l){k.set("isAllowUpload",true)})},testAll:function(){var i=this;return i.testRequire()&&i.testMax()},getRule:function(j){var i=this,k=i.get("rules");return k[j]},isUploaderType:function(j){var i=this,l=i.get("uploader"),k=l.get("type");return j==k},testRequire:function(){var j=this,o=j.get("uploader"),i=o.get("urlsInput"),n=i.get("urls"),m=j.getRule("require"),l=m?m[0]:false,k=n.length>0;if(!l){return true}if(!k){f.log(a+m[1]);j.fire(c.event.ERROR,{rule:"require",msg:m[1],value:l})}return k},testAllowExt:function(j){if(!f.isObject(j)){return false}var p=this,k=j.name,n=p.getRule("allowExts"),l=[],r,i,q;if(!f.isArray(n)){return false}l=p._getExts(n[0].ext);q=m(k);if(!q){r=o(k);i=f.substitute(n[1],{ext:r});p._stopUpload(j,i);p.fire(c.event.ERROR,{rule:"allowExts",msg:i,value:n[0]})}function m(u){var t=false,s;f.each(l,function(v){s=new RegExp("^.+."+v+"$");if(s.test(u)){return t=true}});return t}function o(t){var s=t.split(".");return s[s.length-1]}return q},testMax:function(){var k=this,p=k.get("uploader"),j=p.get("queue"),m=j.getFiles("success"),i=m.length,o=k.getRule("max");if(o){var l=p.get("button"),n=i<o[0];if(!n){l.set("disabled",true);p.set("isAllowUpload",false);k.fire(c.event.ERROR,{rule:"max",msg:o[1],value:o[0]})}else{l.set("disabled",false);p.set("isAllowUpload",true)}return n}},testMaxSize:function(k){var i=this,j=k.size,m=i.getRule("maxSize");if(m){var o=Number(m[0])*1000,l=j<=o,n;if(!l){n=f.substitute(m[1],{maxSize:f.convertByteSize(o),size:k.textSize});i._stopUpload(k,n);i.fire(c.event.ERROR,{rule:"maxSize",msg:n,value:m[0]})}return l}},testRepeat:function(l){if(!f.isObject(l)){return false}var r=this,m=l.name,q=r.getRule("allowRepeat");if(q){var k=q[0],j=q[1],n=r.get("uploader"),o=n.get("queue"),i=o.getFiles("success"),p=false;if(k){return false}f.each(i,function(s){if(s.name==m){r._stopUpload(l,j);r.fire(c.event.ERROR,{rule:"allowRepeat",msg:j,value:q[0]});return p=true}});return p}},_setSwfButtonExt:function(){var j=this,l=j.get("uploader"),i=j.getRule("allowExts"),k=l.get("button"),m=j.isUploaderType("flash");if(!m||!f.isArray(i)){return false}k.set("fileFilters",i[0]);return j},_getExts:function(l){if(!f.isString(l)){return false}var j=l.split(";"),i=[],k=/^\*\./;f.each(j,function(m){m=m.replace(k,"");i.push(m.toUpperCase())});f.each(i,function(m){j.push(m)});return j},_stopUpload:function(l,n){if(!f.isString(n)){n=h}var j=this,m=j.get("uploader"),i=m.get("queue"),k=i.getFileIndex(l.id);i.fileStatus(k,i.constructor.status.ERROR,{msg:n})}},{ATTRS:{uploader:{value:h},rules:{value:{allowExts:[{desc:"JPG,JPEG,PNG,GIF,BMP",ext:"*.jpg;*.jpeg;*.png;*.gif;*.bmp"},"不支持{ext}格式的文件上传！"],require:[false,"必须至少上传一个文件！"],max:[3,"每次最多上传{max}个文件！"],maxSize:[1000,"文件大小为{size}，文件太大！"],allowRepeat:[false,"该文件已经存在！"]}}}});return c},{requires:["node","base"]});KISSY.add("gallery/form/1.2/uploader/base",function(d,f,h,j,k,a,i){var b="",e=h.all,g="[uploader]:";function c(m){var l=this;c.superclass.constructor.call(l,m)}d.mix(c,{type:{AUTO:"auto",IFRAME:"iframe",AJAX:"ajax",FLASH:"flash"},event:{RENDER:"render",SELECT:"select",START:"start",PROGRESS:"progress",COMPLETE:"complete",SUCCESS:"success",UPLOAD_FILES:"uploadFiles",CANCEL:"cancel",ERROR:"error"},status:{WAITING:"waiting",START:"start",PROGRESS:"progress",SUCCESS:"success",CANCEL:"cancel",ERROR:"error",RESTORE:"restore"}});d.extend(c,f,{render:function(){var m=this,r=m.get("serverConfig"),o=m.get("type"),l=m.getUploadType(o),p,q=l.event,n;if(!l){return false}m.set("urlsInput",m._renderUrlsInput());m._renderQueue();n=m._renderButton();if(m.get("type")==c.type.FLASH){d.mix(r,{swfUploader:n.get("swfUploader")})}p=new l(r);p.on(q.SUCCESS,m._uploadCompleteHanlder,m);if(q.PROGRESS){p.on(q.PROGRESS,m._uploadProgressHandler,m)}p.on(q.STOP,m._uploadStopHanlder,m);m.set("uploadType",p);m.fire(c.event.RENDER);return m},upload:function(n){if(!d.isNumber(n)){return false}var m=this,r=m.get("uploadType"),p=m.get("type"),l=m.get("queue"),o=l.get("files")[n],q;if(!d.isPlainObject(o)){d.log(g+"队列中不存在id为"+n+"的文件");return false}if(m.get("curUploadIndex")!=b){alert("第"+m.get("curUploadIndex")+"文件正在上传，请上传完后再操作！");return false}q=o.input.id||o.input;if(p=="ajax"){q=o.data}if(o.status==="error"){return false}m.fire(c.event.START,{index:n,file:o});if(!m.get("isAllowUpload")){return false}m.set("curUploadIndex",n);l.fileStatus(n,c.status.START);r.upload(q)},cancel:function(o){var n=this,q=n.get("uploadType"),l=n.get("queue"),p=c.status,m=l.fileStatus(o);if(d.isNumber(o)&&m!=p.SUCCESS){q.stop();l.fileStatus(o,p.CANCEL)}else{q.stop();n._continueUpload()}return n},stop:function(){var l=this;l.set("uploadFilesStatus",b);l.cancel();return l},uploadFiles:function(l){var m=this;if(!d.isString(l)){l=c.status.WAITING}m.set("uploadFilesStatus",l);m._uploaderStatusFile(l);return m},_uploaderStatusFile:function(n){var o=this,m=o.get("queue"),l=m.getIndexs(n);if(!l.length){o.set("uploadFilesStatus",b);o.fire(c.event.UPLOAD_FILES);return false}o.upload(l[0]);return o},isSupportAjax:function(){var l=false;try{if(FormData){l=true}}catch(m){l=false}return l},isSupportFlash:function(){var l=d.UA.fpv();return d.isArray(l)&&l.length>0},getUploadType:function(o){var m=this,n=c.type,l;if(o==n.AUTO){o=[n.AJAX,o.FLASH,n.IFRAME]}if(d.isArray(o)&&o.length>0){d.each(o,function(p){l=m._getType(p);if(l){return false}})}else{l=m._getType(o)}return l},_getType:function(p){var m=this,o=c.type,l,n=m.isSupportAjax(),q=m.isSupportFlash();switch(p){case o.IFRAME:l=k;break;case o.AJAX:l=n&&a||false;break;case o.FLASH:l=q&&i||false;break;default:d.log(g+"type参数不合法");return false}if(l){d.log(g+"使用"+p+"上传方式")}m.set("type",p);return l},_renderButton:function(){var m=this,n=m.get("button"),l=m.get("multiple"),o=m.get("disabled");if(!d.isObject(n)){d.log(g+"button参数不合法！");return false}n.on("change",m._select,m);n.render();n.set("multiple",l);n.set("disabled",o);return n},_renderQueue:function(){var n=this,l=n.get("queue"),m=n.get("urlsInput");if(!d.isObject(l)){d.log(g+"queue参数不合法");return false}l.set("uploader",n);l.on("remove",function(o){m.remove(o.file.sUrl)});return l},_select:function(p){var m=this,o=m.get("autoUpload"),l=m.get("queue"),q=m.get("curUploadIndex"),n=p.files;d.each(n,function(r){if(!r.size){r.size=0}if(!r.name){r.name=r.fileName||b}r.input=p.input||r});m.fire(c.event.SELECT,{files:n});if(!m.get("isAllowUpload")){return false}l.add(n,function(){if(q==b&&o){m.uploadFiles()}})},_renderUrlsInput:function(){var m=this,o=m.get("button"),p=o.get("target"),n=m.get("urlsInputName"),l=new j(p,{name:n});l.render();return l},_uploadCompleteHanlder:function(r){var o=this,m=r.result,n,q=c.event,l=o.get("queue"),p=o.get("curUploadIndex");if(!d.isObject(m)){return false}l.updateFile(p,{result:m});n=Number(m.status);if(n===1){l.fileStatus(p,c.status.SUCCESS);o._success(m.data);o.fire(q.SUCCESS,{index:p,file:l.getFile(p),result:m})}else{var s=m.msg||m.message||b;l.fileStatus(p,c.status.ERROR,{msg:s,result:m});o.fire(q.ERROR,{status:n,result:m})}o.set("curUploadIndex",b);o.fire(q.COMPLETE,{index:p,file:l.getFile(p),result:m});o._continueUpload()},_uploadStopHanlder:function(){var m=this,l=m.get("queue"),n=m.get("curUploadIndex");l.fileStatus(n,c.status.CANCEL);m.set("curUploadIndex",b);m.fire(c.event.CANCEL,{index:n})},_continueUpload:function(){var l=this,m=l.get("uploadFilesStatus");if(m!=b){l._uploaderStatusFile(m)}},_uploadProgressHandler:function(p){var m=this,l=m.get("queue"),n=m.get("curUploadIndex"),o=l.getFile(n);d.mix(p,{file:o});l.fileStatus(n,c.status.PROGRESS,p);m.fire(c.event.PROGRESS,p)},_success:function(q){if(!d.isObject(q)){return false}var n=this,o=q.url,m=n.get("urlsInput"),p=n.get("curUploadIndex"),l=n.get("queue");if(!d.isString(o)||!d.isObject(m)){return false}l.updateFile(p,{sUrl:o});m.add(o)},restore:function(o){var n=this,l=n.get("queue"),m=n.get("urlsInput");if(!o){o=n._getRestoreData()}if(!o.length){return false}d.each(o,function(r){if(!r.sUrl&&r.result){r.sUrl=r.result.data.url}var q=l.add(r),s=q.id,p=l.getFileIndex(s);m.add(r.sUrl);l.fileStatus(p,"success",{index:p,id:s,file:q})})},_getRestoreData:function(){var m=this,n=m.get("restoreHook"),l=e(n);if(!l.length){return[]}return d.JSON.parse(l.html())}},{ATTRS:{button:{value:{}},queue:{value:{}},type:{value:c.type.AUTO},multiple:{value:true,setter:function(m){var l=this,n=l.get("button");if(!d.isEmptyObject(n)&&d.isBoolean(m)){n.set("multiple",m)}return m}},disabled:{value:false,setter:function(m){var l=this,n=l.get("button");if(!d.isEmptyObject(n)&&d.isBoolean(m)){n.set("disabled",m)}return m}},serverConfig:{value:{action:b,data:{},dataType:"json"}},isAllowUpload:{value:true},autoUpload:{value:true},urlsInputName:{value:b},curUploadIndex:{value:b},uploadType:{value:{}},urlsInput:{value:b},uploadFilesStatus:{value:b},restoreHook:{value:b}}});d.convertByteSize=function(l){var m=-1;do{l=l/1024;m++}while(l>99);return Math.max(l,0.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][m]};return c},{requires:["base","node","./urlsInput","./type/iframe","./type/ajax","./type/flash","flash"]});KISSY.add("gallery/form/1.2/uploader/button/base",function(e,c,d){var g="",b="[Uploader-Button] ",f=c.all;function a(j,i){var h=this;i=e.merge({target:f(j)},i);a.superclass.constructor.call(h,i)}e.mix(a,{event:{beforeShow:"beforeShow",afterShow:"afterShow",beforeHide:"beforeHide",afterHide:"afterHide",beforeRender:"beforeRender",afterRender:"afterRender",CHANGE:"change"},getFileName:function(h){return h.replace(/.*(\/|\\)/,"")}});e.extend(a,d,{render:function(){var h=this,j=h.get("target"),i=h.fire(a.event.beforeRender);if(i===false){e.log(b+"button render was prevented.");return false}else{if(j==null){e.log(b+"Cannot find target!");return false}h._createInput();h._setDisabled(h.get("disabled"));h._setMultiple(h.get("multiple"));h.fire(a.event.afterRender);return h}},show:function(){var h=this,i=h.get("target");i.show();h.fire(a.event.afterShow);return a},hide:function(){var h=this,i=h.get("target");i.hide();h.fire(a.event.afterHide);return a},reset:function(){var h=this,i=h.get("inputContainer");f(i).remove();h.set("inputContainer",g);h.set("fileInput",g);h._createInput();return h},_createInput:function(){var h=this,m=h.get("target"),j=h.get("name"),i=h.get("tpl"),k,n,l;if(!e.isString(j)||!e.isString(i)){e.log(b+"No name or tpl specified.");return false}k=e.substitute(i,{name:j});n=f(k);f(n).appendTo(m);l=f(n).children("input");f(l).on("change",h._changeHandler,h);h.set("fileInput",l);h.set("inputContainer",n);return n},_changeHandler:function(l){var i=this,k=i.get("fileInput"),m=f(k).val(),h=l.target.files,j=[];if(m==g){e.log(b+"No file selected.");return false}if(h){e.each(h,function(n){if(e.isObject(n)){j.push({name:n.name,type:n.type,size:n.size,data:n})}})}else{j.push({name:a.getFileName(m)})}i.fire(a.event.CHANGE,{files:j,input:k.getDOMNode()});i.reset()},_setDisabled:function(l){var k=this,i=k.get("cls"),m=i.disabled,h=k.get("target"),j=k.get("fileInput");if(!h.length||!e.isBoolean(l)){return false}if(!l){h.removeClass(m);f(j).show()}else{h.addClass(m);f(j).hide()}return l},_setMultiple:function(h){var i=this,j=i.get("fileInput");if(!j.length){return false}h&&j.attr("multiple","multiple")||j.removeAttr("multiple");return h}},{ATTRS:{target:{value:null},fileInput:{value:g},inputContainer:{value:g},tpl:{value:'<div class="file-input-wrapper"><input type="file" name="{name}" hidefocus="true" class="file-input" style="font-size:400px;" /></div>'},name:{value:"fileInput",setter:function(h){if(this.get("fileInput")){f(this.get("fileInput")).attr("name",h)}return h}},disabled:{value:false,setter:function(h){this._setDisabled(h);return h}},multiple:{value:true,setter:function(h){this._setMultiple(h);return h}},cls:{value:{disabled:"uploader-button-disabled"}}}});return a},{requires:["node","base"]});KISSY.add("gallery/form/1.2/uploader/button/swfButton",function(e,c,d,f){var h="",g=c.all,b="swf-uploader-wrapper-";function a(k,j){var i=this;j=e.merge({target:g(k)},j);a.superclass.constructor.call(i,j)}e.mix(a,{event:{RENDER:"render",CHANGE:"change",MOUSE_OVER:"mouseOver",MOUSE_DOWN:"mouseDown",MOUSE_UP:"mouseUp",MOUSE_OUT:"mouseOut",CLICK:"click"}});e.extend(a,d,{render:function(){var l=this,j=l.get("target"),k,i=l.get("multiple"),m=l.get("fileFilters");j.css("position","relative");l.set("swfWrapper",l._createSwfWrapper());l._setFlashSizeConfig();k=l._initSwfUploader();k.on("contentReady",function(n){k.browse(i,m);l._bindBtnEvent();k.on("fileSelect",l._changeHandler,l);l._setDisabled(l.get("disabled"));l.fire(a.event.RENDER)},l)},_createSwfWrapper:function(){var i=this,l=i.get("target"),j=i.get("tpl"),m=i.get("swfWrapperId")!=h&&i.get("swfWrapperId")||b+e.guid(),k=e.substitute(j,{id:m});i.set("swfWrapperId",m);return g(k).appendTo(l)},_initSwfUploader:function(){var j=this,k=j.get("flash"),m=j.get("swfWrapperId"),i;try{i=new f(m,k);j.set("swfUploader",i)}catch(l){}return i},_bindBtnEvent:function(){var j=this,k=a.event,i=j.get("swfUploader");if(!i){return false}e.each(k,function(l){i.on(l,function(m){j.fire(l)},j)});return j},_setFlashSizeConfig:function(){var i=this,j=i.get("flash"),k=i.get("target");e.mix(j.attrs,{width:k.width(),height:k.height()});i.set("flash",j)},_changeHandler:function(k){var i=this,j=k.fileList;i.fire(a.event.CHANGE,{files:j})},_setDisabled:function(n){var l=this,k=l.get("swfUploader"),j=l.get("cls"),o=j.disabled,i=l.get("target"),m=l.get("swfWrapper");if(!k||!e.isBoolean(n)){return false}if(!n){i.removeClass(o);m.show()}else{i.addClass(o);m.hide()}return n}},{ATTRS:{target:{value:h},swfWrapper:{value:h},swfWrapperId:{value:h},tpl:{value:'<div id="{id}" class="uploader-button-swf" style="position: absolute;top:0;left:0;"></div>'},multiple:{value:true,setter:function(k){var j=this,i=j.get("swfUploader");if(i){i.multifile(k)}return k}},fileFilters:{value:[],setter:function(k){var j=this,i=j.get("swfUploader");if(i&&e.isArray(k)){i.filter(k)}return k}},disabled:{value:false,setter:function(k){var j=this,i=j.get("swfUploader");if(i){j._setDisabled(k)}return k}},cls:{value:{disabled:"uploader-button-disabled"}},flash:{value:{src:"http://a.tbcdn.cn/s/kissy/gallery/form/1.1/uploader/plugins/ajbridge/uploader.swf",id:"swfUploader",params:{bgcolor:"#fff",wmode:"transparent"},attrs:{},hand:true,btn:true}},swfUploader:{value:h}}});return a},{requires:["node","base","../plugins/ajbridge/uploader"]});KISSY.add("gallery/form/1.2/uploader/index",function(f,i,l,d,j,g,m,e){var c="",h=l.all,k="[uploaderRender]:",a={CONFIG:"data-config",BUTTON_CONFIG:"data-button-config",THEME_CONFIG:"data-theme-config",AUTH:"data-auth"},n=["default","imageUploader","ershouUploader"],o="gallery/form/1.2/uploader/themes/";f.namespace("form");f.form.parseConfig=function(u,p){var q={},t,r=p||a.CONFIG;t=h(u).attr(r);if(!f.isString(t)){return{}}try{q=f.JSON.parse(t)}catch(s){f.log(k+"请检查"+u+"上"+r+"属性内的json格式是否符合规范！")}return q};function b(s,p,r){var q=this;r=f.mix(f.form.parseConfig(s),r);b.superclass.constructor.call(q,r);q.set("buttonTarget",s);q.set("queueTarget",p);q.set("uploaderConfig",r);q._init()}f.extend(b,i,{_init:function(){var q=this,s=q._initButton(),p=q._initQueue(),v=q._initUploader(s,p),t=q._auth(),r={uploader:v,button:s,queue:p,auth:t},u=q.get("theme");q.set("button",s);if(u==c){f.later(function(){q.fire("init",r)},500)}else{q._initThemes(function(w){w.set("uploader",v);w.set("button",s);w.set("queue",p);w.set("auth",t);w._UploaderRender(function(){v.restore();w.afterUploaderRender(v);q.fire("init",r)})})}},_initUploader:function(t,p){var q=this,s=q.get("uploaderConfig"),r=q.get("name");f.mix(s.serverConfig,{fileDataName:r});f.mix(s,{button:t,queue:p});var u=new d(s);u.render();q.set("uploader",u);return u},_initButton:function(){var p=this,t=p.get("buttonTarget"),r=f.form.parseConfig(t,a.BUTTON_CONFIG),q=p.get("name"),s=p.get("type");r=f.merge({name:q},r);return s!="flash"&&new j(t,r)||new g(t)},_initQueue:function(){return new e()},_initThemes:function(u){var p=this,t=p.get("theme"),s=p.get("buttonTarget"),r=p.get("themeConfig"),q=f.form.parseConfig(s,a.THEME_CONFIG);f.mix(q,r);p.set("themeConfig",q);t=p._getThemeName(t);f.use(t,function(x,w){var v=p.get("queueTarget"),y;x.mix(q,{queueTarget:v});y=new w(q);u&&u.call(p,y)})},_getThemeName:function(q){var p=q;f.each(n,function(r){if(r==q){p=o+q}});p=p+"/index";return p},_auth:function(){var p=this,s=p.get("buttonTarget"),u=p.get("uploader"),t=p.get("authConfig"),q=f.form.parseConfig(s,a.AUTH),r=c;f.mix(q,t);p.set("authConfig",q);if(f.isEmptyObject(q)){return false}r=new m(u,{rules:q});u.set("auth",r);return r}},{ATTRS:{theme:{value:"gallery/form/1.2/uploader/themes/default"},themeConfig:{value:{}},buttonTarget:{value:c},queueTarget:{value:c},uploaderConfig:{},authConfig:{value:{}},button:{value:c},queue:{value:c},uploader:{value:c}}});return b},{requires:["base","node","./base","./button/base","./button/swfButton","./auth/base","./queue"]});KISSY.add("gallery/form/1.2/uploader/plugins/ajbridge/ajbridge",function(b,h){var a="#",g="1.0.15",f="ks-ajb-",c=100,e="KISSY.AJBridge.eventHandler";function d(n,j,k){n=n.replace(a,"");j=h._normalize(j||{});var i=this,l=a+n,m=function(o){if(o.status<1){i.fire("failed",{data:o});return}b.mix(i,o);if(!o.dynamic||!j.src){i.activate()}};j.id=j.id||b.guid(f);d.instances[j.id]=i;if(j.src){j.params.allowscriptaccess="always";j.params.flashvars=b.merge(j.params.flashvars,{jsEntry:e,swfID:j.id})}if(k){i.__args=[l,j,m]}else{b.later(h.add,c,false,h,[l,j,m])}}b.app(d,{version:g,instances:{},eventHandler:function(k,j){var i=d.instances[k];if(i){i.__eventHandler(k,j)}},augment:function(j,i){if(b.isString(i)){i=[i]}if(!b.isArray(i)){return}b.each(i,function(k){j.prototype[k]=function(){try{return this.callSWF(k,b.makeArray(arguments))}catch(l){this.fire("error",{message:l})}}})}});b.augment(d,b.EventTarget,{init:function(){if(!this.__args){return}h.add.apply(h,this.__args);this.__args=null;delete this.__args},__eventHandler:function(l,k){var i=this,j=k.type;k.id=l;switch(j){case"log":b.log(k.message);break;default:i.fire(j,k)}},callSWF:function(k,j){var i=this;j=j||[];try{if(i.swf[k]){return i.swf[k].apply(i.swf,j)}}catch(l){var m="";if(j.length!==0){m="'"+j.join("','")+"'"}return(new Function("self","return self.swf."+k+"("+m+");"))(i)}}});d.augment(d,["activate","getReady","getCoreVersion"]);window.AJBridge=b.AJBridge=d;return d},{requires:["flash"]});KISSY.add("gallery/form/1.2/uploader/plugins/ajbridge/uploader",function(c,b,a){function d(g,f){f=f||{};var e={};c.each(["ds","dsp","btn","hand"],function(h){if(h in f){e[h]=f[h]}});f.params=f.params||{};f.params.flashvars=c.merge(f.params.flashvars,e);d.superclass.constructor.call(this,g,f)}c.extend(d,a);a.augment(d,["setFileFilters","filter","setAllowMultipleFiles","multifile","browse","upload","uploadAll","cancel","getFile","removeFile","lock","unlock","setBtnMode","useHand","clear"]);d.version="1.0.1";a.Uploader=d;return a.Uploader},{requires:["flash","./ajbridge"]});KISSY.add("gallery/form/1.2/uploader/plugins/filedrop/filedrop",function(d,b,c){var g="",f=b.all,e=d.UA;var h=function(j){var i=this;h.superclass.constructor.call(i,j);i.set("mode",a())};var a=function(){if(e.webkit>=7||e.firefox>=3.6){return"supportDrop"}if(e.ie){return"notSupportDropIe"}if(e.webkit<7||e.firefox<3.6){return"notSupportDrop"}};d.mix(h,{event:{AFTER_DROP:"afterdrop"}});d.extend(h,c,{render:function(){var j=this,l=j.get("mode"),k=j.get("uploader"),i;if(l!="supportDrop"){d.log("该浏览器不支持拖拽上传！");return false}if(!k){d.log("缺少Uploader的实例！");return false}i=j._createDropArea();if(i.length){i.on("click",j._clickHandler,j)}console.log("after randeer");j.fire("afterRender",{buttonTarget:j.get("buttonWrap")})},show:function(){var i=this,j=i.get("dropContainer");j.show()},hide:function(){var i=this,j=i.get("dropContainer");j.hide()},reset:function(){},_createDropArea:function(){var j=this,l=f(j.get("target")),n=j.get("mode"),k=d.substitute(j.get("tpl")[n],{name:j.get("name")}),m=f(k),i=m.all(".J_ButtonWrap");m.appendTo(l);m.on("dragover",function(o){o.stopPropagation();o.preventDefault()});m.on("drop",function(o){o.stopPropagation();o.preventDefault();j._dropHandler(o)});j.set("dropContainer",m);j.set("buttonWrap",i);j._setStyle();return m},_setStyle:function(){var i=this,j=i.get("dropContainer");if(!j.length){return false}j.parent().css("position","relative");j.css({position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"1000"})},_clickHandler:function(l){var j=this,i=f(l.target),m=j.get("uploader"),k=m.get("button"),n=k.get("fileInput");n.fire("click")},_dropHandler:function(m){var i=this,l=h.event,j=m.originalEvent.dataTransfer.files,k=[],n=i.get("uploader");if(!j.length||n==g){return false}d.each(j,function(o){if(d.isObject(o)){k.push({name:o.name,type:o.type,size:o.size,data:o})}});i.fire(l.AFTER_DROP,{files:k});n._select({files:k})},_setDisabled:function(){}},{ATTRS:{target:{value:g},uploader:{value:g},dropContainer:{value:g},tpl:{value:{supportDrop:'<div class="drop-wrapper"><p>直接拖拽图片到这里，</p><p class="J_ButtonWrap">或者</p></div>',notSupportDropIe:'<div class="drop-wrapper"><p>您的浏览器只支持传统的图片上传，</p><p class="suggest J_ButtonWrap">推荐使用chrome浏览器或firefox浏览器</p></div>',notSupportDrop:'<div class="drop-wrapper"><p>您的浏览器只支持传统的图片上传，</p><p class="suggest J_ButtonWrap">推荐升级您的浏览器</p></div>'}},name:{value:"",setter:function(i){}},disabled:{value:false,setter:function(i){this._setDisabled(i);return i}},cls:{disabled:"drop-area-disabled"}}});return h},{requires:["node","base"]});KISSY.add("gallery/form/1.2/uploader/plugins/preview/preview",function(e,a,i){var h=document,d="[Plugin: Preview] ",b=f(),j={check:"check",success:"success",showed:"showed",error:"error"},k=e.UA.ie<8?"http://a.tbcdn.cn/p/fp/2011a/assets/space.gif":"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";function f(){var l="";if(typeof window.FileReader==="undefined"){switch(e.UA.shell){case"firefox":l="domfile";break;case"ie":switch(e.UA.ie){case 6:l="simple";break;default:l="filter";break}break}}else{l="html5"}return l}function g(o,n,m,l){if(!o){return false}if(b!="filter"){o.src=n||k}else{o.src=k;if(n){n=n.replace(/[)'"%]/g,function(p){return escape(escape(p))});o.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src='"+n+"')";o.zoom=1}}return true}function c(m){var l=this,n={maxWidth:40,maxHeight:40};l.config=e.mix(n,m);e.log(d+"Preview initialized. The preview mode is "+b)}e.augment(c,e.EventTarget,{preview:function(o,p){o=a.get(o);p=a.get(p);var n=this,m=function(){n.fire(j.getData,{data:n.data,mode:b});if(p){g(p,n.data);n.fire(j.showed,{img:p})}};n.data=undefined;if(o){e.log(d+"One file selected. Getting data...");switch(b){case"domfile":n.data=o.files[0].getAsDataURL();break;case"filter":o.select();try{n.data=h.selection.createRange().text}catch(q){e.log(d+"Get image data error, the error is: ");e.log(q,"dir")}finally{h.selection.empty()}if(!n.data){n.data=o.value}break;case"html5":var l=new FileReader();l.onload=function(r){n.data=r.target.result;m()};l.onerror=function(r){e.log(d+"File Reader Error. Your browser may not fully support html5 file api","warning");n.fire(j.error)};if(o.files){l.readAsDataURL(o.files[0])}break;case"simple":default:n.data=o.value;break}if(n.data){m()}else{if(b!="html5"){e.log(d+"Retrive Data error.");g(p);n.fire(j.error)}}}else{e.log(d+"File Input Element does not exists.")}return n.data}});return c},{requires:["dom","event"]});KISSY.add("gallery/form/1.2/uploader/plugins/progressBar/progressBar",function(d,g,f){var a="",e=g.all,i="progressbar",b="role",h="aria-valuemin",l="aria-valuemax",c="aria-valuenow",j="data-value";function k(o,n){var m=this;n=d.merge({wrapper:e(o)},n);k.superclass.constructor.call(m,n)}d.mix(k,{tpl:{DEFAULT:'<div class="ks-progress-bar-value" data-value="{value}"></div>'},cls:{PROGRESS_BAR:"ks-progress-bar",VALUE:"ks-progress-bar-value"},event:{RENDER:"render",CHANGE:"change",SHOW:"show",HIDE:"hide"}});d.extend(k,f,{render:function(){var m=this,o=m.get("wrapper"),n=m.get("width");if(!o.length){return false}o.addClass(k.cls.PROGRESS_BAR).width(n);m._addAttr();!m.get("visible")&&m.hide();m.set("bar",m._create());m.fire(k.event.RENDER)},show:function(){var m=this,n=m.get("wrapper");n.fadeIn(m.get("duration"),function(){m.set("visible",true);m.fire(k.event.SHOW,{visible:true})})},hide:function(){var m=this,n=m.get("wrapper");n.fadeOut(m.get("duration"),function(){m.set("visible",false);m.fire(k.event.HIDE,{visible:false})})},_create:function(){var m=this,q=m.get("wrapper"),p=m.get("value"),n=m.get("tpl"),o=d.substitute(n,{value:p});q.html("");return e(o).appendTo(q)},_addAttr:function(){var m=this,o=m.get("wrapper"),n=m.get("value");o.attr(b,i);o.attr(h,0);o.attr(l,100);o.attr(c,n);return m}},{ATTRS:{wrapper:{value:a},bar:{value:a},width:{value:100},value:{value:0,setter:function(n){var m=this,q=m.get("wrapper"),r=m.get("bar"),p=m.get("speed"),o;if(n>100){n=100}if(n<0){n=0}o=q.width()*(n/100);r.animate({width:o+"px"},p,"none",function(){q.attr(c,n);r.attr(j,n);m.fire(k.event.CHANGE,{value:n,width:o})});return n}},visible:{value:true},duration:{value:0.3},tpl:{value:k.tpl.DEFAULT},speed:{value:0.2}}});return k},{requires:["node","base"]});KISSY.add("gallery/form/1.2/uploader/queue",function(d,b,c){var g="",f=b.all,a="[uploader-queue]:";function e(i){var h=this;e.superclass.constructor.call(h,i)}d.mix(e,{tpl:{DEFAULT:'<li id="queue-file-{id}" class="clearfix" data-name="{name}"><div class="f-l sprite file-icon"></div><div class="f-l">{name}</div><div class="f-l file-status J_FileStatus"></div></li>'},event:{ADD:"add",ADD_FILES:"addFiles",REMOVE:"remove",CLEAR:"clear",FILE_STATUS:"statusChange",UPDATE_FILE:"updateFile",RESTORE:"restore"},status:{WAITING:"waiting",START:"start",PROGRESS:"progress",SUCCESS:"success",CANCEL:"cancel",ERROR:"error",RESTORE:"restore"},cls:{QUEUE:"ks-uploader-queue"},hook:{STATUS:".J_FileStatus"},FILE_ID_PREFIX:"file-"});d.extend(e,c,{add:function(j,k){var h=this,i={};if(j.length>0){i=[];d.each(j,function(l){i.push(h._addFile(l))})}else{i=h._addFile(j)}k&&k.call(h);return i},_addFile:function(l,m){if(!d.isObject(l)){d.log(a+"_addFile()参数file不合法！");return false}var i=this,k=i._setAddFileData(l),j=i.getFileIndex(k.id),h=i.get("fnAdd");if(d.isFunction(h)){k=h(j,k)}i.fire(e.event.ADD,{index:j,file:k,uploader:i.get("uploader")});m&&m.call(i,j,k);return k},remove:function(i,l){var h=this,k=h.get("files"),j;if(d.isString(i)){i=h.getFileIndex(i)}j=k[i];if(!d.isObject(j)){d.log(a+"remove()不存在index为"+i+"的文件数据");return false}k=d.filter(k,function(n,m){return m!==i});h.set("files",k);h.fire(e.event.REMOVE,{index:i,file:j});l&&l.call(h,i,j);return j},clear:function(){var h=this,j;i();function i(){j=h.get("files");if(!j.length){h.fire(e.event.CLEAR);return false}h.remove(0,function(){i()})}},fileStatus:function(l,i,k){if(!d.isNumber(l)){return false}var j=this,n=j.getFile(l),o=j.get("theme"),h,m;if(!n){return false}h=n.status;if(!i){return h}if(h==i){return j}j.updateFile(l,{status:i});m="_"+i+"Handler";if(o&&d.isFunction(o[m])){k=d.merge({uploader:j.get("uploader"),index:l,file:n,id:n.id},k);o[m].call(o,k)}j.fire(e.event.FILE_STATUS,{index:l,status:i,args:k,file:n});return j},getFile:function(i){if(!d.isNumber(i)){return false}var h=this,k=h.get("files"),j=k[i];if(!d.isPlainObject(j)){d.log("getFile():文件数据为空！");j={}}return j},getFileIndex:function(h){var i=this,k=i.get("files"),j=-1;d.each(k,function(m,l){if(m.id==h){j=l;return true}});return j},updateFile:function(i,l){if(!d.isNumber(i)){return false}if(!d.isObject(l)){d.log(a+"updateFile()的data参数有误！");return false}var h=this,k=h.get("files"),j=h.getFile(i);if(!j){return false}d.mix(j,l);k[i]=j;h.set("files",k);h.fire(e.event.UPDATE_FILE,{index:i,file:j});return j},getIndexs:function(j){var i=this,k=i.get("files"),h,l=[];if(!k.length){return l}d.each(k,function(n,m){if(d.isObject(n)){h=n.status;if(h==j){l.push(m)}}});return l},getFiles:function(h){var i=this,k=i.get("files"),j=[];if(!k.length){return[]}d.each(k,function(l){if(l&&l.status==h){j.push(l)}});return j},_setAddFileData:function(i){var h=this,j=h.get("files");if(!d.isObject(i)){d.log(a+"_updateFileData()参数file不合法！");return false}if(!i.id){i.id=d.guid(e.FILE_ID_PREFIX)}if(i.size){i.textSize=d.convertByteSize(i.size)}i.status=g;j.push(i);return i}},{ATTRS:{fnAdd:{value:g},files:{value:[]},uploader:{value:g},theme:{value:g}}});return e},{requires:["node","base"]});KISSY.add("gallery/form/1.2/uploader/theme",function(e,c,d){var g="",f=c.all,a={BUTTON:"-button",QUEUE:"-queue"};function b(i){var h=this;b.superclass.constructor.call(h,i);h._LoaderCss()}e.extend(b,d,{afterUploaderRender:function(h){},_getStatusWrapper:function(h){return h.children(".J_FileStatus")},displayFile:function(i,k,l){var h=this,j=h.get("duration");if(!k||!k.length){return false}k[i&&"fadeIn"||"fadeOut"](j,function(){l&&l.call(h)})},_waitingHandler:function(h){},_startHandler:function(h){},_progressHandler:function(h){},_successHandler:function(h){},_errorHandler:function(h){},_restoreHandler:function(h){},_UploaderRender:function(i){var h=this;h._initQueue();h._addThemeCssName();h._loadPlugins(i)},_addThemeCssName:function(){var i=this,j=i.get("name"),h=i.get("queue"),m=f(i.get("queueTarget")),k=i.get("button"),l;if(j==g||!h||!m.length){return false}m.addClass(j+a.QUEUE);if(!k){return false}l=k.get("target");l.addClass(j+a.BUTTON)},_initQueue:function(){var i=this,h=i.get("queue");h.set("fnAdd",function(j,k){return i._addCallback(j,k)});h.set("theme",i);h.on("add",i._addFileHandler,i);h.on("remove",i._removeFileHandler,i);h.on("statusChange",function(j){i._setStatusVisibility(j)});return h},_LoaderCss:function(){var h=this,i=h.get("cssUrl");if(i==g){return false}e.use(i,function(){e.log(i+"加载成功！")})},_addCallback:function(k,l){var j=this,i=j.get("queue"),h=j._appendFileDom(l);i.updateFile(k,{target:h,statusWrapper:j._getStatusWrapper(h)});i.fileStatus(k,"waiting");j.displayFile(true,h);j._bindTriggerEvent(k,l);return i.getFile(k)},_removeFileHandler:function(j){var h=this,i=j.file;h.displayFile(false,i.target)},_bindTriggerEvent:function(o,i){var p=this,m=p.get("queue"),l=p.get("uploader"),h=i.id,n=f(".J_Upload_"+h),k=f(".J_Cancel_"+h),j=f(".J_Del_"+h);n.on("click",function(q){q.preventDefault();if(!e.isObject(l)){return false}l.upload(o)});k.on("click",function(q){q.preventDefault();l.cancel(o)});j.on("click",function(q){q.preventDefault();m.remove(h)})},_setStatusVisibility:function(k){var l=k.file.statusWrapper,j,i=k.file,h=i.status;if(!l||!l.length){e.log("状态容器层不存在！");return false}j=l.children(".status");j.hide();l.children("."+h+"-status").show()},_appendFileDom:function(k){var i=this,j=i.get("fileTpl"),h=f(i.get("queueTarget")),l;if(!h.length){return false}l=e.substitute(j,k);return f(l).hide().appendTo(h).data("data-file",k)},_loadPlugins:function(m){var i=this,h=i.get("plugins"),l=i.get("oPlugin"),k="gallery/form/1.2/uploader/plugins/",j=[];if(!h.length){m&&m.call(i,l);return false}e.each(h,function(n){j.push(k+n+"/"+n)});e.use(j.join(","),function(){e.each(arguments,function(n,o){if(o>=1){l[h[o-1]]=n}});i.set("oPlugin",l);m&&m.call(i,l)})}},{ATTRS:{name:{value:g},cssUrl:{value:g},fileTpl:{value:g},plugins:{value:[]},oPlugin:{value:{}},queueTarget:{value:g},duration:{value:0.3},queue:{value:g},uploader:{value:g},button:{value:g},auth:{value:g}}});return b},{requires:["node","base"]});KISSY.add("gallery/form/1.2/uploader/type/ajax",function(d,c,b){var f="",e=c.all,a="[uploader-AjaxType]:";function g(i){var h=this;g.superclass.constructor.call(h,i)}d.mix(g,{event:d.merge(b.event,{PROGRESS:"progress"})});d.extend(g,b,{upload:function(i){if(!i){d.log(a+"upload()，fileData参数有误！");return false}var h=this;h._setFormData();h._addFileData(i);h.send();return h},stop:function(){var h=this,i=h.get("xhr");if(!d.isObject(i)){d.log(a+"stop()，io值错误！");return false}i.abort();h.fire(g.event.STOP);return h},send:function(){var h=this,j=h.get("action"),i=h.get("formData");var k=new XMLHttpRequest();k.upload.addEventListener("progress",function(l){h.fire(g.event.PROGRESS,{loaded:l.loaded,total:l.total})});k.onload=function(m){var l={};try{l=d.JSON.parse(k.responseText)}catch(n){d.log(a+"ajax返回结果集responseText格式不合法！")}h.fire(g.event.SUCCESS,{result:l})};k.open("POST",j,true);k.send(i);h._setFormData();h.set("xhr",k);return h},_setFormData:function(){var h=this;try{h.set("formData",new FormData());h._processData()}catch(i){d.log(a+"something error when reset FormData.");d.log(i,"dir")}},_processData:function(){var h=this,i=h.get("data"),j=h.get("formData");d.each(i,function(l,k){j.append(k,l)});h.set("formData",j)},_addFileData:function(i){if(!d.isObject(i)){d.log(a+"_addFileData()，file参数有误！");return false}var h=this,j=h.get("formData"),k=h.get("fileDataName");j.append(k,i);h.set("formData",j)}},{ATTRS:{formData:{value:f},ajaxConfig:{value:{type:"post",processData:false,cache:false,dataType:"json",contentType:false}},xhr:{value:f},fileDataName:{value:f},form:{value:{}},fileInput:{value:f}}});return g},{requires:["node","./base"]});KISSY.add("gallery/form/1.2/uploader/type/base",function(d,b,c){var f="",e=b.all;function a(h){var g=this;a.superclass.constructor.call(g,h)}d.mix(a,{event:{START:"start",STOP:"stop",SUCCESS:"success",ERROR:"error"}});d.extend(a,c,{upload:function(){},stop:function(){}},{ATTRS:{action:{value:f},data:{value:{}}}});return a},{requires:["node","base"]});KISSY.add("gallery/form/1.2/uploader/type/flash",function(e,d,c,a){var h="",g=d.all,b="[uploader-FlashType]:";function f(j){var i=this;f.superclass.constructor.call(i,j);i._init()}e.mix(f,{event:e.merge(c.event,{SWF_READY:"swfReady",PROGRESS:"progress"})});e.extend(f,c,{_init:function(){var j=this,i=j.get("swfUploader");if(!i){e.log(b+"swfUploader对象为空！");return false}i.on("contentReady",function(k){j.fire(f.event.SWF_READY)},j);i.on("uploadStart",j._uploadStartHandler,j);i.on("uploadProgress",j._uploadProgressHandler,j);i.on("uploadCompleteData",j._uploadCompleteDataHandler,j);i.on("uploadError",j._uploadErrorHandler,j)},upload:function(n){var j=this,i=j.get("swfUploader"),l=j.get("action"),m="POST",k=j.get("data");j.set("uploadingId",n);i.upload(n,l,m,k);return j},stop:function(){var k=this,j=k.get("swfUploader"),i=k.get("uploadingId");if(i!=h){j.cancel(i);k.fire(f.event.STOP,{id:i})}return k},_uploadStartHandler:function(j){var i=this;i.fire(f.event.START,{file:j.file})},_uploadProgressHandler:function(j){var i=this;e.mix(j,{loaded:j.bytesLoaded,total:j.bytesTotal});i.fire(f.event.PROGRESS,{loaded:j.loaded,total:j.total})},_uploadCompleteDataHandler:function(l){var j=this,i;try{i=JSON.parse(l.data)}catch(k){e.log(b+"json数据格式不合法！");j.fire(f.event.ERROR,{msg:"不是合法的json数据"})}j.set("uploadingId",h);j.fire(f.event.SUCCESS,{result:i})},_uploadErrorHandler:function(j){var i=this;i.set("uploadingId",h);i.fire(f.event.ERROR,{msg:j.msg})}},{ATTRS:{swfUploader:{value:h},uploadingId:{value:h}}});return f},{requires:["node","./base"]});KISSY.add("gallery/form/1.2/uploader/type/iframe",function(e,d,c){var h="",g=d.all,b="[uploader-iframeType]:",a="ks-uploader-iframe-";function f(j){var i=this;f.superclass.constructor.call(i,j)}e.mix(f,{tpl:{IFRAME:'<iframe src="javascript:false;" name="{id}" id="{id}" border="no" width="1" height="1" style="display: none;" />',FORM:'<form method="post" enctype="multipart/form-data" action="{action}" target="{target}">{hiddenInputs}</form>',HIDDEN_INPUT:'<input type="hidden" name="{name}" value="{value}" />'},event:e.mix(c.event,{CREATE:"create",REMOVE:"remove"})});e.extend(f,c,{upload:function(k){var i=this,l=g(k),j;if(!l.length){return false}i.fire(f.event.START,{input:l});i.set("fileInput",l);i._create();j=i.get("form");j.getDOMNode().submit()},stop:function(){var i=this,j=i.get("iframe");j.attr("src",'javascript:"<html></html>";');i.fire(f.event.STOP);i.fire(f.event.ERROR,{status:"abort",msg:"上传失败，原因：abort"});return i},dataToHidden:function(n){if(!e.isObject(n)||e.isEmptyObject(n)){e.log(b+"data参数不是对象或者为空！");return false}var l=this,j=h,m=l.get("tpl"),o=m.HIDDEN_INPUT;if(!e.isString(o)){return false}for(var i in n){j+=e.substitute(o,{name:i,value:n[i]})}return j},_createIframe:function(){var j=this,o=a+e.guid(),k=j.get("tpl"),l=k.IFRAME,i=j.get("iframe"),m,n;if(!e.isEmptyObject(i)){return i}if(!e.isString(l)){e.log(b+"iframe的模板不合法！");return false}if(!e.isString(o)){e.log(b+"id必须存在且为字符串类型！");return false}m=e.substitute(k.IFRAME,{id:o});n=g(m);n.on("load",j._iframeLoadHandler,j);g("body").append(n);j.set("id",o);j.set("iframe",n);return n},_iframeLoadHandler:function(m){var j=this,k=m.target,o=f.event.ERROR,n=k.contentDocument||window.frames[k.id].document,i;if(!n||!n.body){j.fire(o,{msg:"服务器端返回数据有问题！"});return false}i=n.body.innerHTML;e.log(b+"服务器端输出:"+i);if(i==h){return false}try{i=JSON.parse(i)}catch(l){e.log(b+"json数据格式不合法！");j.fire(o,{msg:"数据："+i+"不是合法的json数据"})}j.fire(f.event.SUCCESS,{result:i});j._remove()},_createForm:function(){var q=this,j=q.get("id"),o=q.get("tpl"),p=o.FORM,l=q.get("data"),k=q.get("action"),m=q.get("fileInput"),n,r,i;if(!e.isString(p)){e.log(b+"form模板不合法！");return false}if(!e.isObject(l)){e.log(b+"data参数不合法！");return false}if(!e.isString(k)){e.log(b+"action参数不合法！");return false}n=q.dataToHidden(l);if(n==h){return false}i=e.substitute(p,{action:k,target:j,hiddenInputs:n});r=g(i).append(m);g("body").append(r);q.set("form",r);return r},_create:function(){var i=this,j=i._createIframe(),k=i._createForm();i.fire(f.event.CREATE,{iframe:j,form:k})},_remove:function(){var i=this,j=i.get("form");j.remove();i.reset("form");i.fire(f.event.REMOVE,{form:j})}},{ATTRS:{tpl:{value:f.tpl},id:{value:a+e.guid()},iframe:{value:{}},form:{value:{}},fileInput:{value:h}}});return f},{requires:["node","./base"]});KISSY.add("gallery/form/1.2/uploader/urlsInput",function(e,c,d){var g="",f=c.all,b="[uploader-urlsInput]:";function a(j,i){var h=this;a.superclass.constructor.call(h,i);h.set("wrapper",f(j))}e.mix(a,{TPL:'<input type="hidden" id="{name}" name="{name}" value="{value}" />'});e.extend(a,d,{render:function(){var i=this,k=i.get("wrapper"),j=i.get("name"),h=document.getElementsByName(j)[0];if(!e.isObject(k)){e.log(b+"container参数不合法！");return false}if(h){e.log(b+"urls input found");i.set("input",f(h))}else{i._create()}return i},add:function(i){if(!e.isString(i)){e.log(b+"add()的url参数不合法！");return false}var h=this,k=h.get("urls"),j=h.isExist(i);if(k[0]==g){k=[]}if(j){e.log(b+"add()，文件路径已经存在！");return h}k.push(i);h.set("urls",k);h._val();return h},remove:function(i){if(!i){return false}var h=this,l=h.get("urls"),k=h.isExist(i),j=new RegExp(i);if(!k){e.log(b+"remove()，不存在该文件路径！");return false}l=e.filter(l,function(m){return !j.test(m)});h.set("urls",l);h._val();return l},parse:function(){var i=this,h=i.get("input");if(h){var l=f(h).val(),j=i.get("split"),k;k=l.split(j);i.set("urls",k);return k}else{e.log(b+"cannot find urls input.");return[]}},_val:function(){var h=this,k=h.get("urls"),l=h.get("input"),i=h.get("split"),j=k.join(i);l.val(j);return j},isExist:function(j){var i=this,h=false,l=i.get("urls"),k=new RegExp(j);if(!l.length){return false}e.each(l,function(m){if(k.test(m)){return h=true}});return h},_create:function(){var j=this,h=j.get("wrapper"),l=j.get("tpl"),k=j.get("name"),m=j.get("urls"),i;if(!h||h.length<=0){e.log(b+"UrlsInput container not specified!","warn");return false}if(!e.isString(l)||!e.isString("name")){e.log(b+"_create()，tpl和name属性不合法！");return false}i=f(e.substitute(l,{name:k,value:m}));h.append(i);j.set("input",i);e.log(b+"input created.");return i}},{ATTRS:{name:{value:g},urls:{value:[]},tpl:{value:a.TPL},split:{value:",",setter:function(i){var h=this;h._val();return i}},input:{value:g},wrapper:{value:g}}});return a},{requires:["node","base"]});