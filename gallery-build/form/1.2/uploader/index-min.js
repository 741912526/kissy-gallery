/**
 * @fileoverview 文件上传验证
 * @author: 剑平（明河）<minghe36@126.com>
 **/KISSY.add("gallery/form/1.2/uploader/auth/base",function(a,b,c){function h(b,c){var d=this;c=a.merge({uploader:b},c),h.superclass.constructor.call(d,c),d._init()}var d="",e=b.all,f=f||a,g="[uploader-auth]:";return a.mix(h,{event:{ERROR:"error"}}),a.extend(h,c,{_init:function(){var a=this,b=a.get("uploader"),c=b.get("queue");if(b==d)return f.log(g+"uploader\u4e0d\u53ef\u4ee5\u4e3a\u7a7a\uff01"),!1;a._setSwfButtonExt(),c.on("add",function(b){var c=b.file;a.testAllowExt(c),a.testMaxSize(c),a.testRepeat(c)}),c.on("remove",function(b){var c=b.file,d=c.status;d=="success"&&a.testMax()}),c.on("statusChange",function(b){var c=b.status;c=="success"&&a.testMax()}),b.on("error",function(a){b.set("isAllowUpload",!0)})},testAll:function(){var a=this;return a.testRequire()&&a.testMax()},getRule:function(a){var b=this,c=b.get("rules");return c[a]},isUploaderType:function(a){var b=this,c=b.get("uploader"),d=c.get("type");return a==d},testRequire:function(){var b=this,c=b.get("uploader"),d=c.get("urlsInput"),e=d.get("urls"),f=b.getRule("require"),h=f?f[0]:!1,i=e.length>0;return h?(i||(a.log(g+f[1]),b._fireUploaderError("require",f)),i):!0},testAllowExt:function(b){function j(b){var c=!1,d;return a.each(f,function(a){d=new RegExp("^.+."+a+"$");if(d.test(b))return c=!0}),c}function k(a){var b=a.split(".");return b[b.length-1]}if(!a.isObject(b))return!1;var c=this,d=b.name,e=c.getRule("allowExts"),f=[],g,h,i;return a.isArray(e)?(f=c._getExts(e[0].ext),i=j(d),i||(g=k(d),h=a.substitute(e[1],{ext:g}),c._fireUploaderError("allowExts",[e[0],h],b)),i):!1},testMax:function(){var b=this,c=b.get("uploader"),d=c.get("queue"),e=d.getFiles("success"),f=e.length,g=b.getRule("max"),h;if(g){var i=c.get("button"),j=f<g[0];return j?(i.set("disabled",!1),c.set("isAllowUpload",!0)):(c.set("disabled",!0),c.set("isAllowUpload",!1),h=a.substitute(g[1],{max:g[0]}),b._fireUploaderError("max",[g[0],h])),j}},testMaxSize:function(b){var c=this,d=b.size,e=c.getRule("maxSize");if(e){var f=Number(e[0])*1e3,g=d<=f,h;return g||(h=a.substitute(e[1],{maxSize:a.convertByteSize(f),size:b.textSize}),c._fireUploaderError("maxSize",[e[0],h],b)),g}},testRepeat:function(b){if(!a.isObject(b))return!1;var c=this,d=b.name,e=c.getRule("allowRepeat");if(e){var f=e[0],g=c.get("uploader"),h=g.get("queue"),i=h.getFiles("success"),j=!1;return f?!1:(a.each(i,function(a){if(a.name==d)return c._fireUploaderError("allowRepeat",e,b),j=!0}),j)}},_setSwfButtonExt:function(){var b=this,c=b.get("uploader"),d=b.getRule("allowExts"),e=c.get("button"),f=b.isUploaderType("flash");return!f||!a.isArray(d)?!1:(e.set("fileFilters",d[0]),b)},_getExts:function(b){if(!a.isString(b))return!1;var c=b.split(";"),d=[],e=/^\*\./;return a.each(c,function(a){a=a.replace(e,""),d.push(a.toUpperCase())}),a.each(d,function(a){c.push(a)}),c},_fireUploaderError:function(b,c,d){var e=this,f=e.get("uploader"),g=f.get("queue"),i={status:-1,rule:b},j=-1;d&&(a.mix(i,{file:d}),j=g.getFileIndex(i.file.id)),c&&a.mix(i,{msg:c[1],value:c[0],result:{}}),g.fileStatus(j,"error",i),e.fire(h.event.ERROR,i),f.fire("error",i)}},{ATTRS:{uploader:{value:d},rules:{value:{allowExts:[{desc:"JPG,JPEG,PNG,GIF,BMP",ext:"*.jpg;*.jpeg;*.png;*.gif;*.bmp"},"\u4e0d\u652f\u6301{ext}\u683c\u5f0f\u7684\u6587\u4ef6\u4e0a\u4f20\uff01"],require:[!1,"\u5fc5\u987b\u81f3\u5c11\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6\uff01"],max:[3,"\u6bcf\u6b21\u6700\u591a\u4e0a\u4f20{max}\u4e2a\u6587\u4ef6\uff01"],maxSize:[1e3,"\u6587\u4ef6\u5927\u5c0f\u4e3a{size}\uff0c\u6587\u4ef6\u592a\u5927\uff01"],allowRepeat:[!1,"\u8be5\u6587\u4ef6\u5df2\u7ecf\u5b58\u5728\uff01"]}}}}),h},{requires:["node","base"]}),KISSY.add("gallery/form/1.2/uploader/base",function(a,b,c,d,e,f,g,h,i,j){function n(a){var b=this;n.superclass.constructor.call(b,a)}var k="",l=c.all,m="[uploader]:";return a.mix(n,{type:{AUTO:"auto",IFRAME:"iframe",AJAX:"ajax",FLASH:"flash"},event:{RENDER:"render",SELECT:"select",START:"start",PROGRESS:"progress",COMPLETE:"complete",SUCCESS:"success",UPLOAD_FILES:"uploadFiles",CANCEL:"cancel",ERROR:"error"},status:{WAITING:"waiting",START:"start",PROGRESS:"progress",SUCCESS:"success",CANCEL:"cancel",ERROR:"error",RESTORE:"restore"}}),a.extend(n,b,{render:function(){var b=this,c=b.get("serverConfig"),d=b.get("type"),e=b.getUploadType(d),f,g=e.event,h;return e?(h=b._renderButton(),b.set("urlsInput",b._renderUrlsInput()),b._renderQueue(),b.get("type")==n.type.FLASH&&a.mix(c,{swfUploader:h.get("swfUploader")}),f=new e(c),f.on(g.SUCCESS,b._uploadCompleteHanlder,b),g.PROGRESS&&f.on(g.PROGRESS,b._uploadProgressHandler,b),f.on(g.STOP,b._uploadStopHanlder,b),b.set("uploadType",f),b.fire(n.event.RENDER),b):!1},upload:function(b){if(!a.isNumber(b))return!1;var c=this,d=c.get("uploadType"),e=c.get("type"),f=c.get("queue"),g=f.get("files")[b],h;if(!a.isPlainObject(g))return a.log(m+"\u961f\u5217\u4e2d\u4e0d\u5b58\u5728id\u4e3a"+b+"\u7684\u6587\u4ef6"),!1;if(c.get("curUploadIndex")!=k)return alert("\u7b2c"+c.get("curUploadIndex")+"\u6587\u4ef6\u6b63\u5728\u4e0a\u4f20\uff0c\u8bf7\u4e0a\u4f20\u5b8c\u540e\u518d\u64cd\u4f5c\uff01"),!1;h=g.input.id||g.input,e=="ajax"&&(h=g.data);if(g.status==="error")return!1;c.fire(n.event.START,{index:b,file:g});if(!c.get("isAllowUpload"))return!1;c.set("curUploadIndex",b),f.fileStatus(b,n.status.START),d.upload(h)},cancel:function(b){var c=this,d=c.get("uploadType"),e=c.get("queue"),f=n.status,g=e.fileStatus(b);return a.isNumber(b)&&g!=f.SUCCESS?(d.stop(),e.fileStatus(b,f.CANCEL)):(d.stop(),c._continueUpload()),c},stop:function(){var a=this;return a.set("uploadFilesStatus",k),a.cancel(),a},uploadFiles:function(b){var c=this;return a.isString(b)||(b=n.status.WAITING),c.set("uploadFilesStatus",b),c._uploaderStatusFile(b),c},_uploaderStatusFile:function(a){var b=this,c=b.get("queue"),d=c.getIndexs(a);return d.length?(b.upload(d[0]),b):(b.set("uploadFilesStatus",k),b.fire(n.event.UPLOAD_FILES),!1)},isSupportAjax:function(){var a=!1;try{FormData&&(a=!0)}catch(b){a=!1}return a},isSupportFlash:function(){var b=a.UA.fpv();return a.isArray(b)&&b.length>0},getUploadType:function(b){var c=this,d=n.type,e;return b==d.AUTO&&(b=[d.AJAX,d.FLASH,d.IFRAME]),a.isArray(b)&&b.length>0?a.each(b,function(a){e=c._getType(a);if(e)return!1}):e=c._getType(b),e},_getType:function(b){var c=this,d=n.type,h,i=c.isSupportAjax(),j=c.isSupportFlash();switch(b){case d.IFRAME:h=e;break;case d.AJAX:h=i&&f||!1;break;case d.FLASH:h=j&&g||!1;break;default:return a.log(m+"type\u53c2\u6570\u4e0d\u5408\u6cd5"),!1}return h&&a.log(m+"\u4f7f\u7528"+b+"\u4e0a\u4f20\u65b9\u5f0f"),c.set("type",b),h},_renderButton:function(){var b=this,c,d,e=b.get("type"),f=b.get("target"),g=b.get("multiple"),j=b.get("disabled"),k=b.get("name"),l={name:k,multiple:g,disabled:j};return e==n.type.FLASH?(d=i,a.mix(l,{size:b.get("swfSize")})):d=h,c=new d(f,l),c.on("change",b._select,b),c.render(),b.set("button",c),c},_renderQueue:function(){var b=this,c=new j,d=b.get("urlsInput");return a.isObject(c)?(c.set("uploader",b),c.on("remove",function(a){a.file.sUrl&&d&&d.remove(a.file.sUrl)}),b.set("queue",c),c):(a.log(m+"queue\u53c2\u6570\u4e0d\u5408\u6cd5"),!1)},_select:function(b){var c=this,d=c.get("autoUpload"),e=c.get("queue"),f=c.get("curUploadIndex"),g=b.files;a.each(g,function(a){a.size||(a.size=0),a.name||(a.name=a.fileName||k),a.input=b.input||a}),g=c._processExceedMultiple(g),c.fire(n.event.SELECT,{files:g});if(!c.get("isAllowUpload"))return!1;e.add(g,function(){f==k&&d&&c.uploadFiles()})},_processExceedMultiple:function(b){var c=this,d=c.get("multipleLen");return d<0||!a.isArray(b)||!b.length?b:a.filter(b,function(a,b){return b<d})},_renderUrlsInput:function(){var a=this,b=a.get("button"),c=b.get("target"),e=a.get("urlsInputName"),f=new d(c,{name:e});return f.render(),f},_uploadCompleteHanlder:function(b){var c=this,d=b.result,e,f=n.event,g=c.get("queue"),h=c.get("curUploadIndex");if(!a.isObject(d))return!1;g.updateFile(h,{result:d}),e=Number(d.status);if(e===1)g.fileStatus(h,n.status.SUCCESS),c._success(d.data),c.fire(f.SUCCESS,{index:h,file:g.getFile(h),result:d});else{var i=d.msg||d.message||k;g.fileStatus(h,n.status.ERROR,{msg:i,result:d}),c.fire(f.ERROR,{status:e,result:d,index:h,file:g.getFile(h)})}c.set("curUploadIndex",k),c.fire(f.COMPLETE,{index:h,file:g.getFile(h),result:d}),c._continueUpload()},_uploadStopHanlder:function(){var a=this,b=a.get("queue"),c=a.get("curUploadIndex");b.fileStatus(c,n.status.CANCEL),a.set("curUploadIndex",k),a.fire(n.event.CANCEL,{index:c})},_continueUpload:function(){var a=this,b=a.get("uploadFilesStatus");b!=k&&a._uploaderStatusFile(b)},_uploadProgressHandler:function(b){var c=this,d=c.get("queue"),e=c.get("curUploadIndex"),f=d.getFile(e);a.mix(b,{file:f}),d.fileStatus(e,n.status.PROGRESS,b),c.fire(n.event.PROGRESS,b)},_success:function(b){if(!a.isObject(b))return!1;var c=this,d=b.url,e=c.get("urlsInput"),f=c.get("curUploadIndex"),g=c.get("queue");if(!a.isString(d)||!a.isObject(e))return!1;g.updateFile(f,{sUrl:d}),e.add(d)},restore:function(b){var c=this,d=c.get("queue"),e=c.get("urlsInput");b||(b=c._getRestoreData());if(!b.length)return!1;a.each(b,function(a){!a.sUrl&&a.result&&(a.sUrl=a.result.data.url);var b=d.add(a),c=b.id,f=d.getFileIndex(c);e.add(a.sUrl),d.fileStatus(f,"success",{index:f,id:c,file:b})})},_getRestoreData:function(){var b=this,c=b.get("restoreHook"),d=l(c);return d.length?a.JSON.parse(a.trim(d.html())):[]}},{ATTRS:{button:{value:{}},queue:{value:{}},type:{value:n.type.AUTO},multiple:{value:!0,setter:function(b){var c=this,d=c.get("button");return!a.isEmptyObject(d)&&a.isBoolean(b)&&d.set("multiple",b),b}},multipleLen:{value:-1},disabled:{value:!1,setter:function(b){var c=this,d=c.get("button");return!a.isEmptyObject(d)&&a.isBoolean(b)&&d.set("disabled",b),b}},serverConfig:{value:{action:k,data:{},dataType:"json"}},data:{value:{},getter:function(){var a=this,b=a.get("uploadType"),c=a.get("serverConfig").data||{};return b&&(c=b.get("data")),c},setter:function(b){if(a.isObject(b)){var c=this,d=c.get("uploadType");d&&(d.set("data",b),c.set("serverConfig",a.mix(c.get("serverConfig"),{data:b})))}return b}},isAllowUpload:{value:!0},autoUpload:{value:!0},urlsInputName:{value:k},curUploadIndex:{value:k},uploadType:{value:{}},urlsInput:{value:k},uploadFilesStatus:{value:k},restoreHook:{value:k},swfSize:{value:{}}}}),a.convertByteSize=function(a){var b=-1;do a/=1024,b++;while(a>99);return Math.max(a,.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][b]},n},{requires:["base","node","./urlsInput","./type/iframe","./type/ajax","./type/flash","./button/base","./button/swfButton","./queue"]}),KISSY.add("gallery/form/1.2/uploader/button/base",function(a,b,c){function g(b,c){var d=this;c=a.merge({target:f(b)},c),g.superclass.constructor.call(d,c)}var d="",e="[Uploader-Button] ",f=b.all;return a.mix(g,{event:{beforeShow:"beforeShow",afterShow:"afterShow",beforeHide:"beforeHide",afterHide:"afterHide",beforeRender:"beforeRender",afterRender:"afterRender",CHANGE:"change"},getFileName:function(a){return a.replace(/.*(\/|\\)/,"")}}),a.extend(g,c,{render:function(){var b=this,c=b.get("target"),d=b.fire(g.event.beforeRender);return d===!1?(a.log(e+"button render was prevented."),!1):c==null?(a.log(e+"Cannot find target!"),!1):(b._createInput(),b.fire(g.event.afterRender),b)},show:function(){var a=this,b=a.get("target");return b.show(),a.fire(g.event.afterShow),g},hide:function(){var a=this,b=a.get("target");return b.hide(),a.fire(g.event.afterHide),g},reset:function(){var a=this,b=a.get("inputContainer");return f(b).remove(),a.set("inputContainer",d),a.set("fileInput",d),a._createInput(),a},_createInput:function(){var b=this,c=b.get("target"),d=b.get("name"),g=b.get("tpl"),h,i,j;return!a.isString(d)||!a.isString(g)?(a.log(e+"No name or tpl specified."),!1):(h=a.substitute(g,{name:d}),i=f(h),f(i).appendTo(c),j=f(i).children("input"),a.UA.ie==6&&j.css("fontSize","400px"),f(j).on("change",b._changeHandler,b),b.set("fileInput",j),b.set("inputContainer",i),b._setDisabled(b.get("disabled")),b._setMultiple(b.get("multiple")),i)},_changeHandler:function(b){var c=this,h=c.get("fileInput"),i=f(h).val(),j=b.target.files,k=[];if(i==d)return a.log(e+"No file selected."),!1;j?a.each(j,function(b){a.isObject(b)&&k.push({name:b.name,type:b.type,size:b.size,data:b})}):k.push({name:g.getFileName(i)}),c.fire(g.event.CHANGE,{files:k,input:h.getDOMNode()}),c.reset()},_setDisabled:function(b){var c=this,d=c.get("cls"),e=d.disabled,g=c.get("target"),h=c.get("fileInput");return!g.length||!a.isBoolean(b)?!1:(b?(g.addClass(e),f(h).hide()):(g.removeClass(e),f(h).show()),b)},_setMultiple:function(a){var b=this,c=b.get("fileInput");return c.length?(a&&c.attr("multiple","multiple")||c.removeAttr("multiple"),a):!1}},{ATTRS:{target:{value:null},fileInput:{value:d},inputContainer:{value:d},tpl:{value:'<div class="file-input-wrapper" style="overflow: hidden;"><input type="file" name="{name}" hidefocus="true" class="file-input" /></div>'},name:{value:"fileInput",setter:function(a){return this.get("fileInput")&&f(this.get("fileInput")).attr("name",a),a}},disabled:{value:!1,setter:function(a){return this._setDisabled(a),a}},multiple:{value:!0,setter:function(a){return this._setMultiple(a),a}},cls:{value:{disabled:"uploader-button-disabled"}}}}),g},{requires:["node","base"]}),KISSY.add("gallery/form/1.2/uploader/button/swfButton",function(a,b,c,d){function h(b,c){var d=this;c=a.merge({target:f(b)},c),h.superclass.constructor.call(d,c)}var e="",f=b.all,g="swf-uploader-wrapper-";return a.mix(h,{event:{RENDER:"render",CHANGE:"change",MOUSE_OVER:"mouseOver",MOUSE_DOWN:"mouseDown",MOUSE_UP:"mouseUp",MOUSE_OUT:"mouseOut",CLICK:"click"}}),a.extend(h,c,{render:function(){var a=this,b=a.get("target"),c,d=a.get("multiple"),e=a.get("fileFilters");b.css("position","relative"),a.set("swfWrapper",a._createSwfWrapper()),a._setFlashSizeConfig(),c=a._initSwfUploader(),c.on("contentReady",function(b){c.browse(d,e),a._bindBtnEvent(),c.on("fileSelect",a._changeHandler,a),a._setDisabled(a.get("disabled")),a.fire(h.event.RENDER)},a)},_createSwfWrapper:function(){var b=this,c=b.get("target"),d=b.get("tpl"),h=b.get("swfWrapperId")!=e&&b.get("swfWrapperId")||g+a.guid(),i=a.substitute(d,{id:h});return b.set("swfWrapperId",h),f(i).appendTo(c)},_initSwfUploader:function(){var b=this,c=b.get("flash"),e=b.get("swfWrapperId"),f;a.mix(c,{id:"swfUploader"+a.guid()});try{f=new d(e,c),b.set("swfUploader",f)}catch(g){}return f},_bindBtnEvent:function(){var b=this,c=h.event,d=b.get("swfUploader");return d?(a.each(c,function(a){d.on(a,function(c){b.fire(a)},b)}),b):!1},_setFlashSizeConfig:function(){var b=this,c=b.get("flash"),d=b.get("target"),e=b.get("size");a.isEmptyObject(e)?a.mix(c.attrs,{width:d.innerWidth(),height:d.innerHeight()}):a.mix(c.attrs,e),b.set("flash",c)},_changeHandler:function(a){var b=this,c=a.fileList;b.fire(h.event.CHANGE,{files:c})},_setDisabled:function(b){var c=this,d=c.get("swfUploader"),e=c.get("cls"),f=e.disabled,g=c.get("target"),h=c.get("swfWrapper");return!d||!a.isBoolean(b)?!1:(b?(g.addClass(f),h.css("top","-3000px")):(g.removeClass(f),h.css("top",0)),b)},show:function(){var a=this,b=a.get("target");b.show()},hide:function(){var a=this,b=a.get("target");b.hide()}},{ATTRS:{target:{value:e},swfWrapper:{value:e},swfWrapperId:{value:e},tpl:{value:'<div id="{id}" class="uploader-button-swf" style="position: absolute;top:0;left:0;z-index:2000;"></div>'},multiple:{value:!0,setter:function(a){var b=this,c=b.get("swfUploader");return c&&c.multifile(a),a}},fileFilters:{value:[],setter:function(b){var c=this,d=c.get("swfUploader");return a.isObject(b)&&(b=[b]),d&&a.isArray(b)&&a.later(function(){d.filter(b)},500),b}},disabled:{value:!1,setter:function(a){var b=this,c=b.get("swfUploader");return c&&b._setDisabled(a),a}},cls:{value:{disabled:"uploader-button-disabled"}},size:{value:{}},flash:{value:{src:"http://a.tbcdn.cn/s/kissy/gallery/form/1.2/uploader/plugins/ajbridge/uploader.swf",id:"swfUploader",params:{bgcolor:"#fff",wmode:"transparent"},attrs:{},hand:!0,btn:!0}},swfUploader:{value:e}}}),h},{requires:["node","base","../plugins/ajbridge/uploader"]}),KISSY.add("gallery/form/1.2/uploader/index",function(a,b,c,d,e){function l(b,c,d){var e=this;d=a.mix(a.form.parseConfig(b),d),l.superclass.constructor.call(e,d),e.set("buttonTarget",b),e.set("queueTarget",c),e.set("uploaderConfig",d),e._init()}var f="",g=c.all,h="[uploaderRender]:",i={CONFIG:"data-config",BUTTON_CONFIG:"data-button-config",THEME_CONFIG:"data-theme-config",AUTH:"data-auth"},j=["default","imageUploader","ershouUploader","uploadify"],k="gallery/form/1.2/uploader/themes/";return a.namespace("form"),a.form.parseConfig=function(b,c){var d={},e,f=c||i.CONFIG;e=g(b).attr(f);if(!a.isString(e))return{};try{d=a.JSON.parse(e)}catch(j){a.log(h+"\u8bf7\u68c0\u67e5"+b+"\u4e0a"+f+"\u5c5e\u6027\u5185\u7684json\u683c\u5f0f\u662f\u5426\u7b26\u5408\u89c4\u8303\uff01")}return d},a.extend(l,b,{_init:function(){var b=this,c=b.get("theme"),d;c==f?(d=b._initUploader(),b.set("button",d.get("button")),a.later(function(){b.fire("init",{uploader:d,button:d.get("button"),queue:d.get("queue"),auth:d.get("auth")})},500)):b._initThemes(function(a){d=b._initUploader(),b.set("button",d.get("button")),a.set("uploader",d),a.set("button",d.get("button")),a.set("queue",d.get("queue")),a.set("auth",d.get("auth")),a._UploaderRender(function(){a.afterUploaderRender(d),d.restore(),b.fire("init",{uploader:d,button:d.get("button"),queue:d.get("queue"),auth:d.get("auth")})})})},_initUploader:function(){var b=this,c=b.get("uploaderConfig"),e=b.get("name");a.mix(c.serverConfig,{fileDataName:e}),a.mix(c,{target:b.get("buttonTarget")});var f=new d(c);return f.render(),b.set("uploader",f),b._auth(),f},_initThemes:function(b){var c=this,d=c.get("theme"),e=c.get("buttonTarget"),f=c.get("themeConfig"),g=a.form.parseConfig(e,i.THEME_CONFIG);a.mix(g,f),c.set("themeConfig",g),d=c._getThemeName(d),a.use(d,function(a,d){var e=c.get("queueTarget"),f;a.mix(g,{queueTarget:e,buttonTarget:c.get("buttonTarget")}),f=new d(g),f.on("render",function(){b&&b.call(c,f)}),f.render()})},_getThemeName:function(b){var c=b;return a.each(j,function(a){a==b&&(c=k+b)}),c+="/index",c},_auth:function(){var b=this,c=b.get("buttonTarget"),d=b.get("uploader"),f=b.get("authConfig"),g=a.form.parseConfig(c,i.AUTH);return a.mix(g,f),b.set("authConfig",g),a.isEmptyObject(g)?!1:(auth=new e(d,{rules:g}),d.set("auth",auth),auth)}},{ATTRS:{theme:{value:"default"},themeConfig:{value:{}},buttonTarget:{value:f},queueTarget:{value:f},uploaderConfig:{},authConfig:{value:{}},button:{value:f},queue:{value:f},uploader:{value:f}}}),l},{requires:["base","node","./base","./auth/base"]}),YUI.add("yuidoc-meta",function(a){a.YUIDoc={meta:{classes:["AjaxType","Auth","Button","DefaultTheme","ErshouUploader","FileDrop","FlashType","IframeType","ImageUploader","ProgressBar","Queue","RenderUploader","SwfButton","Theme","UploadType","Uploader","Uploadify","UrlsInput"],modules:["uploader","uploader-base","uploader-index"],allModules:[{displayName:"uploader",name:"uploader"},{displayName:"uploader-base",name:"uploader-base",description:"\u5f02\u6b65\u6587\u4ef6\u4e0a\u4f20\u7ec4\u4ef6\u6838\u5fc3\u6a21\u5757"},{displayName:"uploader-index",name:"uploader-index",description:"\u5f02\u6b65\u6587\u4ef6\u4e0a\u4f20\u7ec4\u4ef6\u5165\u53e3\u6a21\u5757"}]}}}),YUI.add("api-filter",function(a){a.APIFilter=a.Base.create("apiFilter",a.Base,[a.AutoCompleteBase],{initializer:function(){this._bindUIACBase(),this._syncUIACBase()},getDisplayName:function(b){return a.each(a.YUIDoc.meta.allModules,function(a){a.name===b&&a.displayName&&(b=a.displayName)}),b}},{ATTRS:{resultHighlighter:{value:"phraseMatch"},queryType:{value:"classes"},source:{valueFn:function(){var b=this;return function(c){var d=a.YUIDoc.meta[b.get("queryType")],e=[];return a.each(d,function(a){a.toLowerCase().indexOf(c.toLowerCase())>-1&&e.push(a)}),e}}}}})},"3.4.0",{requires:["autocomplete-base","autocomplete-highlighters","autocomplete-sources"]}),YUI.add("api-list",function(a){function o(){return j.get("queryType")==="classes"?e:g}function p(e){var f=a.one(a.config.doc.createDocumentFragment()),g=o(),h=j.get("queryType"),i=h==="classes"?"class":"module";e.results.length?c.each(e.results,function(a){f.append(b.sub(n,{rootPath:d.rootPath,displayName:j.getDisplayName(a.highlighted),name:a.text,typePlural:h,typeSingular:i}))}):f.append('<li class="message">No '+h+" found."+"</li>"),g.empty(!0),g.append(f),m.refresh()}function q(a){m.refresh()}function r(a){var b=a.target;if(b.test("input,select,textarea")||b.get("isContentEditable"))return;a.preventDefault(),f.focus(),m.refresh()}function s(b){var d=a.one(a.config.doc.createDocumentFragment());b.results.length?c.each(b.results,function(a){d.append(a.display)}):d.append('<li class="message">No results found. Maybe you\'ll have better luck with a different query?</li>'),m.refresh()}function t(a){var b=a.newVal,c=b.get("label").toLowerCase();i.selected={index:b.get("index"),name:c,tab:b};switch(c){case"classes":case"modules":j.setAttrs({minQueryLength:0,queryType:c}),k.set("minQueryLength",-1),a.prevVal&&j.sendRequest(j.get("value"));break;case"everything":j.set("minQueryLength",-1),k.set("minQueryLength",1),k.get("value")?k.sendRequest(k.get("value")):f.focus();break;default:j.set("minQueryLength",-1),k.set("minQueryLength",-1)}m&&setTimeout(function(){m.refresh()},1)}function u(b){var c=i.selected.index;if(!b.ctrlKey&&!b.metaKey)return;b.preventDefault();switch(b.keyCode){case 37:c>0&&(l.selectChild(c-1),f.focus());break;case 39:c<a.Object.size(i)-2&&(l.selectChild(c+1),f.focus())}}var b=a.Lang,c=a.Array,d=a.namespace("APIList"),e=a.one("#api-classes"),f=a.one("#api-filter"),g=a.one("#api-modules"),h=a.one("#api-tabview"),i=d.tabs={},j=d.filter=new a.APIFilter({inputNode:f,maxResults:1e3,on:{results:p}}),k=d.search=new a.APISearch({inputNode:f,maxResults:100,on:{clear:q,results:s}}),l=d.tabview=new a.TabView({srcNode:h,panelNode:"#api-tabview-panel",render:!0,on:{selectionChange:t}}),m=d.focusManager=h.plug(a.Plugin.NodeFocusManager,{circular:!0,descendants:"#api-filter, .yui3-tab-panel-selected .api-list-item a, .yui3-tab-panel-selected .result a",keys:{next:"down:40",previous:"down:38"}}).focusManager,n='<li class="api-list-item {typeSingular}"><a href="{rootPath}{typePlural}/{name}.html">{displayName}</a></li>';a.before(function(b,c){if(b.altKey||b.ctrlKey||b.metaKey||b.shiftKey)return new a.Do.Prevent},m,"_focusPrevious",m),a.before(function(b,c){if(b.altKey||b.ctrlKey||b.metaKey||b.shiftKey)return new a.Do.Prevent},m,"_focusNext",m),l.each(function(a,b){var c=a.get("label").toLowerCase();i[c]={index:b,name:c,tab:a}}),h.on("key",u,"down:37,39"),a.one(a.config.doc).on("key",r,"down:83"),f.on("focus",function(){m.set("activeDescendant",f)}),l.get("panelNode").all("a").each(function(a){a.setAttribute("href",a.get("href"))})},"3.4.0",{requires:["api-filter","api-search","event-key","node-focusmanager","tabview"]}),YUI.add("api-search",function(a){var b=a.Lang,c=a.Node,d=a.Array;a.APISearch=a.Base.create("apiSearch",a.Base,[a.AutoCompleteBase],{RESULT_TEMPLATE:'<li class="result {resultType}"><a href="{url}"><h3 class="title">{name}</h3><span class="type">{resultType}</span><div class="description">{description}</div><span class="className">{class}</span></a></li>',initializer:function(){this._bindUIACBase(),this._syncUIACBase()},_apiResultFilter:function(a,b){return d.filter(b,function(a){return a.raw.resultType==="component"?!1:a})},_apiResultFormatter:function(e,f){return d.map(f,function(d){var e=a.merge(d.raw),f=e.description||"";return f=c.create("<div>"+f+"</div>").get("text"),f.length>65?f=a.Escape.html(f.substr(0,65))+" &hellip;":f=a.Escape.html(f),e["class"]||(e["class"]=""),e.description=f,e.name=d.highlighted,b.sub(this.RESULT_TEMPLATE,e)},this)},_apiTextLocator:function(a){return a.displayName||a.name}},{ATTRS:{resultFormatter:{valueFn:function(){return this._apiResultFormatter}},resultFilters:{valueFn:function(){return this._apiResultFilter}},resultHighlighter:{value:"phraseMatch"},resultListLocator:{value:"data.results"},resultTextLocator:{valueFn:function(){return this._apiTextLocator}},source:{value:"/api/v1/search?q={query}&count={maxResults}"}}})},"3.4.0",{requires:["autocomplete-base","autocomplete-highlighters","autocomplete-sources","escape"]}),YUI().use("yuidoc-meta","api-list","history-hash","node-screen","node-style","pjax",function(a){var b=a.config.win,c=b.localStorage,d=a.one("#bd"),e,f,g;a.getLocation().protocol.match(/^https?\:/)||(a.Router.html5=!1),e=new a.Pjax({container:"#docs-main",contentSelector:"#docs-main > .content",linkSelector:"#bd a",titleSelector:"#xhr-title",navigateOnHash:!0,root:"/",routes:[{path:"/(index.html)?",callback:"_defaultRoute"},{path:"/classes/:class.html*",callback:"handleClasses"},{path:"/classes/:class.html*",callback:"_defaultRoute"},{path:"/files/*file",callback:"handleFiles"},{path:"/files/*file",callback:"_defaultRoute"},{path:"/modules/:module.html*",callback:"_defaultRoute"}]}),e.checkVisibility=function(b){b||(b=g);if(!b)return;var c=b.get("panelNode"),d;d=c.all(".item,.index-item").some(function(a){if(a.getComputedStyle("display")!=="none")return!0}),c.all(".no-visible-items").remove(),d||(a.one("#index .index-item")?c.append('<div class="no-visible-items"><p>Some items are not shown due to the current visibility settings. Use the checkboxes at the upper right of this page to change the visibility settings.</p></div>'):c.append('<div class="no-visible-items"><p>This class doesn\'t provide any methods, properties, attributes, or events.</p></div>')),a.all(".index-section").each(function(a){var b=0,c=0;a.all(".index-item").each(function(a){b+=1,a.getComputedStyle("display")!=="none"&&(c+=1)}),a.toggleClass("hidden",!c),a.toggleClass("no-columns",c<4)})},e.initClassTabView=function(){if(!a.all("#classdocs .api-class-tab").size())return;f&&(f.destroy(),g=null),f=new a.TabView({srcNode:"#classdocs",on:{selectionChange:e.onTabSelectionChange}}),e.updateTabState(),f.render()},e.initLineNumbers=function(){var a=b.location.hash.substring(1),c=e.get("container"),d,f;c.all(".linenums>li").each(function(a,b){a.set("id","l"+(b+1)),a.addClass("file-line"),d=!0}),d&&/^l\d+$/.test(a)&&(f=c.getById(a))&&b.scroll(0,f.getY())},e.initRoot=function(){var a=/^(?:classes|files|modules)$/,b=e._getRoot().split("/"),c=[],d,f,g;for(d=0,f=b.length;d<f;d+=1){g=b[d];if(g.match(a)){c.push("");break}c.push(g)}e.set("root",c.join("/"))},e.updateTabState=function(d){function l(){i.hasClass("protected")&&(a.one("#api-show-protected").set("checked",!0),e.updateVisibility()),i.hasClass("private")&&(a.one("#api-show-private").set("checked",!0),e.updateVisibility()),setTimeout(function(){var c=a.one("#classdocs").getById(g);b.scrollTo(0,c.getY()-70)},1)}var g=b.location.hash.substring(1),h,i,j,k;if(!f)return;d==="hashchange"&&!g?h="index":c?h=c.getItem("tab_"+e.getPath())||"index":h="index";if(g&&(i=a.one("#classdocs").getById(g))){if(k=i.ancestor(".api-class-tabpanel",!0))if(j=a.one("#classdocs .api-class-tab."+k.get("id")))f.get("rendered")?a.Widget.getByNode(j).set("selected",1):j.addClass("yui3-tab-selected");i&&(f.get("rendered")?l():f.once("renderedChange",l))}else j=a.one("#classdocs .api-class-tab."+h),f.get("rendered")?a.Widget.getByNode(j).set("selected",1):j.addClass("yui3-tab-selected")},e.updateVisibility=function(){var b=e.get("container");b.toggleClass("hide-inherited",!a.one("#api-show-inherited").get("checked")),b.toggleClass("show-deprecated",a.one("#api-show-deprecated").get("checked")),b.toggleClass("show-protected",a.one("#api-show-protected").get("checked")),b.toggleClass("show-private",a.one("#api-show-private").get("checked")),e.checkVisibility()},e.handleClasses=function(a,b,c){e.onceAfter(["error","load"],function(a){a.type==="pjax:load"&&e.initClassTabView()}),c()},e.handleFiles=function(a,b,c){e.onceAfter(["error","load"],function(a){a.type==="pjax:load"&&e.initLineNumbers()}),c()},e.afterContent=function(a){prettyPrint(),d.removeClass("loading")},e.onNavigate=function(a){var c=a.hash,f=a.originEvent&&a.originEvent.target,g;if(c){g=f&&f.ancestor(".yui3-tab",!0),c===b.location.hash?e.updateTabState("hashchange"):g||(b.location.hash=c),a.preventDefault();return}this.set("scrollToTop",!a.url.match(/#.+$/)),d.addClass("loading")},e.onOptionClick=function(a){e.updateVisibility()},e.onTabSelectionChange=function(a){var b=a.newVal,d=b.get("contentBox").getAttribute("href").substring(1);g=b,a.prevVal&&c&&c.setItem("tab_"+e.getPath(),d),e.checkVisibility(b)},e.on("navigate",e.onNavigate),e.after(["error","load"],e.afterContent),e.initRoot(),e.initClassTabView(),e.initLineNumbers(),e.updateVisibility(),e.upgrade(),a.APIList.rootPath=e.get("root"),a.one("#api-options").delegate("click",e.onOptionClick,"input"),a.on("hashchange",function(a){e.updateTabState("hashchange")},b)}),YUI().use("node",function(a){var b=a.all(".prettyprint.linenums");if(b.size()){b.each(function(a){var b=a.all("ol li"),c=1;b.each(function(a){a.prepend('<a name="LINENUM_'+c+'"></a>'),c++})});var c=location.hash;location.hash="",c=c.replace("LINE_","LINENUM_"),location.hash=c}}),window.PR_SHOULD_USE_CONTINUATION=!0,window.PR_TAB_WIDTH=8,window.PR_normalizedHtml=window.PR=window.prettyPrintOne=window.prettyPrint=void 0,window._pr_isIE6=function(){var a=navigator&&navigator.userAgent&&navigator.userAgent.match(/\bMSIE ([678])\./);return a=a?+a[1]:!1,window._pr_isIE6=function(){return a},a},function(){function a(a){return a.replace(v,"&amp;").replace(w,"&lt;").replace(x,"&gt;")}function b(c,d,e){switch(c.nodeType){case 1:var f=c.tagName.toLowerCase();d.push("<",f);var g=c.attributes,h=g.length;if(h){if(e){for(var i=[],j=h;--j>=0;)i[j]=g[j];i.sort(function(a,b){return a.name<b.name?-1:a.name===b.name?0:1}),g=i}for(j=0;j<h;++j)i=g[j],i.specified&&d.push(" ",i.name.toLowerCase(),'="',i.value.replace(v,"&amp;").replace(w,"&lt;").replace(x,"&gt;").replace(y,"&quot;"),'"')}d.push(">");for(g=c.firstChild;g;g=g.nextSibling)b(g,d,e);(c.firstChild||!/^(?:br|link|img)$/.test(f))&&d.push("</",f,">");break;case 3:case 4:d.push(a(c.nodeValue))}}function c(a){function b(a){if(a.charAt(0)!=="\\")return a.charCodeAt(0);switch(a.charAt(1)){case"b":return 8;case"t":return 9;case"n":return 10;case"v":return 11;case"f":return 12;case"r":return 13;case"u":case"x":return parseInt(a.substring(2),16)||a.charCodeAt(1);case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":return parseInt(a.substring(1),8);default:return a.charCodeAt(1)}}function c(a){if(a<32)return(a<16?"\\x0":"\\x")+a.toString(16);a=String.fromCharCode(a);if(a==="\\"||a==="-"||a==="["||a==="]")a="\\"+a;return a}function d(a){var d=a.substring(1,a.length-1).match(RegExp("\\\\u[0-9A-Fa-f]{4}|\\\\x[0-9A-Fa-f]{2}|\\\\[0-3][0-7]{0,2}|\\\\[0-7]{1,2}|\\\\[\\s\\S]|-|[^-\\\\]","g"));a=[];for(var e=[],f=d[0]==="^",g=f?1:0,h=d.length;g<h;++g){var i=d[g];switch(i){case"\\B":case"\\b":case"\\D":case"\\d":case"\\S":case"\\s":case"\\W":case"\\w":a.push(i);continue}i=b(i);var j;g+2<h&&"-"===d[g+1]?(j=b(d[g+2]),g+=2):j=i,e.push([i,j]),j<65||i>122||(j<65||i>90||e.push([Math.max(65,i)|32,Math.min(j,90)|32]),j<97||i>122||e.push([Math.max(97,i)&-33,Math.min(j,122)&-33]))}e.sort(function(a,b){return a[0]-b[0]||b[1]-a[1]}),d=[],i=[NaN,NaN];for(g=0;g<e.length;++g)h=e[g],h[0]<=i[1]+1?i[1]=Math.max(i[1],h[1]):d.push(i=h);e=["["],f&&e.push("^"),e.push.apply(e,a);for(g=0;g<d.length;++g)h=d[g],e.push(c(h[0])),h[1]>h[0]&&(h[1]+1>h[0]&&e.push("-"),e.push(c(h[1])));return e.push("]"),e.join("")}function e(a){for(var b=a.source.match(RegExp("(?:\\[(?:[^\\x5C\\x5D]|\\\\[\\s\\S])*\\]|\\\\u[A-Fa-f0-9]{4}|\\\\x[A-Fa-f0-9]{2}|\\\\[0-9]+|\\\\[^ux0-9]|\\(\\?[:!=]|[\\(\\)\\^]|[^\\x5B\\x5C\\(\\)\\^]+)","g")),c=b.length,e=[],h=0,i=0;h<c;++h){var j=b[h];j==="("?++i:"\\"===j.charAt(0)&&(j=+j.substring(1))&&j<=i&&(e[j]=-1)}for(h=1;h<e.length;++h)-1===e[h]&&(e[h]=++f);for(i=h=0;h<c;++h)j=b[h],j==="("?(++i,e[i]===undefined&&(b[h]="(?:")):"\\"===j.charAt(0)&&(j=+j.substring(1))&&j<=i&&(b[h]="\\"+e[i]);for(i=h=0;h<c;++h)"^"===b[h]&&"^"!==b[h+1]&&(b[h]="");if(a.ignoreCase&&g)for(h=0;h<c;++h)j=b[h],a=j.charAt(0),j.length>=2&&a==="["?b[h]=d(j):a!=="\\"&&(b[h]=j.replace(/[a-zA-Z]/g,function(a){return a=a.charCodeAt(0),"["+String.fromCharCode(a&-33,a|32)+"]"}));return b.join("")}for(var f=0,g=!1,h=!1,i=0,j=a.length;i<j;++i){var k=a[i];if(k.ignoreCase)h=!0;else if(/[a-z]/i.test(k.source.replace(/\\u[0-9a-f]{4}|\\x[0-9a-f]{2}|\\[^ux]/gi,""))){g=!0,h=!1;break}}var l=[];i=0;for(j=a.length;i<j;++i){k=a[i];if(k.global||k.multiline)throw Error(""+k);l.push("(?:"+e(k)+")")}return RegExp(l.join("|"),h?"gi":"g")}function d(a){var b=0;return function(c){for(var d=null,e=0,f=0,g=c.length;f<g;++f)switch(c.charAt(f)){case"	":d||(d=[]),d.push(c
.substring(e,f)),e=a-b%a;for(b+=e;e>=0;e-=16)d.push("                ".substring(0,e));e=f+1;break;case"\n":b=0;break;default:++b}return d?(d.push(c.substring(e)),d.join("")):c}}function e(a,b,c,d){b&&(a={source:b,c:a},c(a),d.push.apply(d,a.d))}function f(a,b){function h(a){for(var c=a.c,i=[c,r],k=0,l=a.source.match(f)||[],m={},n=0,o=l.length;n<o;++n){var p=l[n],q=m[p],t=void 0,u;if(typeof q=="string")u=!1;else{var v=d[p.charAt(0)];if(v)t=p.match(v[1]),q=v[0];else{for(u=0;u<g;++u){v=b[u];if(t=p.match(v[1])){q=v[0];break}}t||(q=r)}(u=q.length>=5&&"lang-"===q.substring(0,5))&&(!t||typeof t[1]!="string")&&(u=!1,q=s),u||(m[p]=q)}v=k,k+=p.length;if(u){u=t[1];var w=p.indexOf(u),x=w+u.length;t[2]&&(x=p.length-t[2].length,w=x-u.length),q=q.substring(5),e(c+v,p.substring(0,w),h,i),e(c+v+w,u,j(q,u),i),e(c+v+x,p.substring(x),h,i)}else i.push(c+v,q)}a.d=i}var d={},f;(function(){for(var e=a.concat(b),g=[],h={},i=0,j=e.length;i<j;++i){var k=e[i],l=k[3];if(l)for(var m=l.length;--m>=0;)d[l.charAt(m)]=k;k=k[1],l=""+k,h.hasOwnProperty(l)||(g.push(k),h[l]=null)}g.push(/[\0-\uffff]/),f=c(g)})();var g=b.length;return h}function g(a){var b=[],c=[];return a.tripleQuotedStrings?b.push([l,/^(?:\'\'\'(?:[^\'\\]|\\[\s\S]|\'{1,2}(?=[^\']))*(?:\'\'\'|$)|\"\"\"(?:[^\"\\]|\\[\s\S]|\"{1,2}(?=[^\"]))*(?:\"\"\"|$)|\'(?:[^\\\']|\\[\s\S])*(?:\'|$)|\"(?:[^\\\"]|\\[\s\S])*(?:\"|$))/,null,"'\""]):a.multiLineStrings?b.push([l,/^(?:\'(?:[^\\\']|\\[\s\S])*(?:\'|$)|\"(?:[^\\\"]|\\[\s\S])*(?:\"|$)|\`(?:[^\\\`]|\\[\s\S])*(?:\`|$))/,null,"'\"`"]):b.push([l,/^(?:\'(?:[^\\\'\r\n]|\\.)*(?:\'|$)|\"(?:[^\\\"\r\n]|\\.)*(?:\"|$))/,null,"\"'"]),a.verbatimStrings&&c.push([l,/^@\"(?:[^\"]|\"\")*(?:\"|$)/,null]),a.hashComments&&(a.cStyleComments?(b.push([n,/^#(?:(?:define|elif|else|endif|error|ifdef|include|ifndef|line|pragma|undef|warning)\b|[^\r\n]*)/,null,"#"]),c.push([l,/^<(?:(?:(?:\.\.\/)*|\/?)(?:[\w-]+(?:\/[\w-]+)+)?[\w-]+\.h|[a-z]\w*)>/,null])):b.push([n,/^#[^\r\n]*/,null,"#"])),a.cStyleComments&&(c.push([n,/^\/\/[^\r\n]*/,null]),c.push([n,/^\/\*[\s\S]*?(?:\*\/|$)/,null])),a.regexLiterals&&c.push(["lang-regex",RegExp("^"+u+"(/(?=[^/*])(?:[^/\\x5B\\x5C]|\\x5C[\\s\\S]|\\x5B(?:[^\\x5C\\x5D]|\\x5C[\\s\\S])*(?:\\x5D|$))+/)")]),a=a.keywords.replace(/^\s+|\s+$/g,""),a.length&&c.push([m,RegExp("^(?:"+a.replace(/\s+/g,"|")+")\\b"),null]),b.push([r,/^\s+/,null," \r\n	\u00a0"]),c.push([p,/^@[a-z_$][a-z_$@0-9]*/i,null],[o,/^@?[A-Z]+[a-z][A-Za-z_$@0-9]*/,null],[r,/^[a-z_$][a-z_$@0-9]*/i,null],[p,/^(?:0x[a-f0-9]+|(?:\d(?:_\d+)*\d*(?:\.\d*)?|\.\d\+)(?:e[+\-]?\d+)?)[a-z]*/i,null,"0123456789"],[q,/^.[^\s\w\.$@\'\"\`\/\#]*/,null]),f(b,c)}function h(b){function c(b){if(b>i){j&&j!==k&&(h.push("</span>"),j=null),!j&&k&&(j=k,h.push('<span class="',j,'">'));var c=a(n(e.substring(i,b))).replace(s?p:o,"$1&#160;");s=r.test(c),h.push(c.replace(q,v)),i=b}}var e=b.source,f=b.g,g=b.d,h=[],i=0,j=null,k=null,l=0,m=0,n=d(window.PR_TAB_WIDTH),o=/([\r\n ]) /g,p=/(^| ) /gm,q=/\r\n?|\n/g,r=/[ \r\n]$/,s=!0,t=window._pr_isIE6();t=t?b.b.tagName==="PRE"?t===6?"&#160;\r\n":t===7?"&#160;<br>\r":"&#160;\r":"&#160;<br />":"<br />";var u=b.b.className.match(/\blinenums\b(?::(\d+))?/),v;if(u){for(var w=[],x=0;x<10;++x)w[x]=t+'</li><li class="L'+x+'">';var y=u[1]&&u[1].length?u[1]-1:0;h.push('<ol class="linenums"><li class="L',y%10,'"'),y&&h.push(' value="',y+1,'"'),h.push(">"),v=function(){var a=w[++y%10];return j?"</span>"+a+'<span class="'+j+'">':a}}else v=t;for(;;)if(l<f.length?m<g.length?f[l]<=g[m]:!0:!1)c(f[l]),j&&(h.push("</span>"),j=null),h.push(f[l+1]),l+=2;else{if(!(m<g.length))break;c(g[m]),k=g[m+1],m+=2}c(e.length),j&&h.push("</span>"),u&&h.push("</li></ol>"),b.a=h.join("")}function i(a,b){for(var c=b.length;--c>=0;){var d=b[c];N.hasOwnProperty(d)?"console"in window&&console.warn("cannot override language handler %s",d):N[d]=a}}function j(a,b){return a&&N.hasOwnProperty(a)||(a=/^\s*</.test(b)?"default-markup":"default-code"),N[a]}function k(a){var b=a.f,c=a.e;a.a=b;try{var d,e=b.match(H);b=[];var f=0,g=[];if(e)for(var i=0,k=e.length;i<k;++i){var l=e[i];if(l.length>1&&l.charAt(0)==="<"){if(!I.test(l))if(J.test(l))b.push(l.substring(9,l.length-3)),f+=l.length-12;else if(K.test(l))b.push("\n"),++f;else if(l.indexOf(t)>=0&&l.replace(/\s(\w+)\s*=\s*(?:\"([^\"]*)\"|'([^\']*)'|(\S+))/g,' $1="$2$3$4"').match(/[cC][lL][aA][sS][sS]=\"[^\"]*\bnocode\b/)){var m=l.match(L)[2],n=1,o;o=i+1;a:for(;o<k;++o){var p=e[o].match(L);if(p&&p[2]===m)if(p[1]==="/"){if(--n===0)break a}else++n}o<k?(g.push(f,e.slice(i,o+1).join("")),i=o):g.push(f,l)}else g.push(f,l)}else{var q;n=l;var r=n.indexOf("&");if(r<0)q=n;else{for(--r;(r=n.indexOf("&#",r+1))>=0;){var s=n.indexOf(";",r);if(s>=0){var u=n.substring(r+3,s),v=10;u&&u.charAt(0)==="x"&&(u=u.substring(1),v=16);var w=parseInt(u,v);isNaN(w)||(n=n.substring(0,r)+String.fromCharCode(w)+n.substring(s+1))}}q=n.replace(z,"<").replace(A,">").replace(B,"'").replace(C,'"').replace(E," ").replace(D,"&")}b.push(q),f+=q.length}}d={source:b.join(""),h:g};var x=d.source;a.source=x,a.c=0,a.g=d.h,j(c,x)(a),h(a)}catch(y){"console"in window&&console.log(y&&y.stack?y.stack:y)}}var l="str",m="kwd",n="com",o="typ",p="lit",q="pun",r="pln",s="src",t="nocode",u=function(){for(var a=["!","!=","!==","#","%","%=","&","&&","&&=","&=","(","*","*=","+=",",","-=","->","/","/=",":","::",";","<","<<","<<=","<=","=","==","===",">",">=",">>",">>=",">>>",">>>=","?","@","[","^","^=","^^","^^=","{","|","|=","||","||=","~","break","case","continue","delete","do","else","finally","instanceof","return","throw","try","typeof"],b="(?:^^|[+-]",c=0;c<a.length;++c)b+="|"+a[c].replace(/([^=<>:&a-z])/g,"\\$1");return b+=")\\s*",b}(),v=/&/g,w=/</g,x=/>/g,y=/\"/g,z=/&lt;/g,A=/&gt;/g,B=/&apos;/g,C=/&quot;/g,D=/&amp;/g,E=/&nbsp;/g,F=/[\r\n]/g,G=null,H=RegExp("[^<]+|<!--[\\s\\S]*?-->|<!\\[CDATA\\[[\\s\\S]*?\\]\\]>|</?[a-zA-Z](?:[^>\"']|'[^']*'|\"[^\"]*\")*>|<","g"),I=/^<\!--/,J=/^<!\[CDATA\[/,K=/^<br\b/i,L=/^<(\/?)([a-zA-Z][a-zA-Z0-9]*)/,M=g({keywords:"break continue do else for if return while auto case char const default double enum extern float goto int long register short signed sizeof static struct switch typedef union unsigned void volatile catch class delete false import new operator private protected public this throw true try typeof alignof align_union asm axiom bool concept concept_map const_cast constexpr decltype dynamic_cast explicit export friend inline late_check mutable namespace nullptr reinterpret_cast static_assert static_cast template typeid typename using virtual wchar_t where break continue do else for if return while auto case char const default double enum extern float goto int long register short signed sizeof static struct switch typedef union unsigned void volatile catch class delete false import new operator private protected public this throw true try typeof abstract boolean byte extends final finally implements import instanceof null native package strictfp super synchronized throws transient as base by checked decimal delegate descending event fixed foreach from group implicit in interface internal into is lock object out override orderby params partial readonly ref sbyte sealed stackalloc string select uint ulong unchecked unsafe ushort var break continue do else for if return while auto case char const default double enum extern float goto int long register short signed sizeof static struct switch typedef union unsigned void volatile catch class delete false import new operator private protected public this throw true try typeof debugger eval export function get null set undefined var with Infinity NaN caller delete die do dump elsif eval exit foreach for goto if import last local my next no our print package redo require sub undef unless until use wantarray while BEGIN END break continue do else for if return while and as assert class def del elif except exec finally from global import in is lambda nonlocal not or pass print raise try with yield False True None break continue do else for if return while alias and begin case class def defined elsif end ensure false in module next nil not or redo rescue retry self super then true undef unless until when yield BEGIN END break continue do else for if return while case done elif esac eval fi function in local set then until ",hashComments:!0,cStyleComments:!0,multiLineStrings:!0,regexLiterals:!0}),N={};i(M,["default-code"]),i(f([],[[r,/^[^<?]+/],["dec",/^<!\w[^>]*(?:>|$)/],[n,/^<\!--[\s\S]*?(?:-\->|$)/],["lang-",/^<\?([\s\S]+?)(?:\?>|$)/],["lang-",/^<%([\s\S]+?)(?:%>|$)/],[q,/^(?:<[%?]|[%?]>)/],["lang-",/^<xmp\b[^>]*>([\s\S]+?)<\/xmp\b[^>]*>/i],["lang-js",/^<script\b[^>]*>([\s\S]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\s\S]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i]]),["default-markup","htm","html","mxml","xhtml","xml","xsl"]),i(f([[r,/^[\s]+/,null," 	\r\n"],["atv",/^(?:\"[^\"]*\"?|\'[^\']*\'?)/,null,"\"'"]],[["tag",/^^<\/?[a-z](?:[\w.:-]*\w)?|\/?>$/i],["atn",/^(?!style[\s=]|on)[a-z](?:[\w:-]*\w)?/i],["lang-uq.val",/^=\s*([^>\'\"\s]*(?:[^>\'\"\s\/]|\/(?=\s)))/],[q,/^[=<>\/]+/],["lang-js",/^on\w+\s*=\s*\"([^\"]+)\"/i],["lang-js",/^on\w+\s*=\s*\'([^\']+)\'/i],["lang-js",/^on\w+\s*=\s*([^\"\'>\s]+)/i],["lang-css",/^style\s*=\s*\"([^\"]+)\"/i],["lang-css",/^style\s*=\s*\'([^\']+)\'/i],["lang-css",/^style\s*=\s*([^\"\'>\s]+)/i]]),["in.tag"]),i(f([],[["atv",/^[\s\S]+/]]),["uq.val"]),i(g({keywords:"break continue do else for if return while auto case char const default double enum extern float goto int long register short signed sizeof static struct switch typedef union unsigned void volatile catch class delete false import new operator private protected public this throw true try typeof alignof align_union asm axiom bool concept concept_map const_cast constexpr decltype dynamic_cast explicit export friend inline late_check mutable namespace nullptr reinterpret_cast static_assert static_cast template typeid typename using virtual wchar_t where ",hashComments:!0,cStyleComments:!0}),["c","cc","cpp","cxx","cyc","m"]),i(g({keywords:"null true false"}),["json"]),i(g({keywords:"break continue do else for if return while auto case char const default double enum extern float goto int long register short signed sizeof static struct switch typedef union unsigned void volatile catch class delete false import new operator private protected public this throw true try typeof abstract boolean byte extends final finally implements import instanceof null native package strictfp super synchronized throws transient as base by checked decimal delegate descending event fixed foreach from group implicit in interface internal into is lock object out override orderby params partial readonly ref sbyte sealed stackalloc string select uint ulong unchecked unsafe ushort var ",hashComments:!0,cStyleComments:!0,verbatimStrings:!0}),["cs"]),i(g({keywords:"break continue do else for if return while auto case char const default double enum extern float goto int long register short signed sizeof static struct switch typedef union unsigned void volatile catch class delete false import new operator private protected public this throw true try typeof abstract boolean byte extends final finally implements import instanceof null native package strictfp super synchronized throws transient ",cStyleComments:!0}),["java"]),i(g({keywords:"break continue do else for if return while case done elif esac eval fi function in local set then until ",hashComments:!0,multiLineStrings:!0}),["bsh","csh","sh"]),i(g({keywords:"break continue do else for if return while and as assert class def del elif except exec finally from global import in is lambda nonlocal not or pass print raise try with yield False True None ",hashComments:!0,multiLineStrings:!0,tripleQuotedStrings:!0}),["cv","py"]),i(g({keywords:"caller delete die do dump elsif eval exit foreach for goto if import last local my next no our print package redo require sub undef unless until use wantarray while BEGIN END ",hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),["perl","pl","pm"]),i(g({keywords:"break continue do else for if return while alias and begin case class def defined elsif end ensure false in module next nil not or redo rescue retry self super then true undef unless until when yield BEGIN END ",hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),["rb"]),i(g({keywords:"break continue do else for if return while auto case char const default double enum extern float goto int long register short signed sizeof static struct switch typedef union unsigned void volatile catch class delete false import new operator private protected public this throw true try typeof debugger eval export function get null set undefined var with Infinity NaN ",cStyleComments:!0,regexLiterals:!0}),["js"]),i(f([],[[l,/^[\s\S]+/]]),["regex"]),window.PR_normalizedHtml=b,window.prettyPrintOne=function(a,b){var c={f:a,e:b};return k(c),c.a},window.prettyPrint=function(c){function d(){for(var e=window.PR_SHOULD_USE_CONTINUATION?j.now()+250:Infinity;l<f.length&&j.now()<e;l++){var g=f[l];if(g.className&&g.className.indexOf("prettyprint")>=0){var h=g.className.match(/\blang-(\w+)\b/);h&&(h=h[1]);for(var i=!1,n=g.parentNode;n;n=n.parentNode)if((n.tagName==="pre"||n.tagName==="code"||n.tagName==="xmp")&&n.className&&n.className.indexOf("prettyprint")>=0){i=!0;break}if(!i){n=g,null===G&&(i=document.createElement("PRE"),i.appendChild(document.createTextNode('<!DOCTYPE foo PUBLIC "foo bar">\n<foo />')),G=!/</.test(i.innerHTML));if(G){i=n.innerHTML;if("XMP"===n.tagName)i=a(i);else{n=n;if("PRE"===n.tagName)n=!0;else if(F.test(i)){var o="";n.currentStyle?o=n.currentStyle.whiteSpace:window.getComputedStyle&&(o=window.getComputedStyle(n,null).whiteSpace),n=!o||o==="pre"}else n=!0;n||(i=i.replace(/(<br\s*\/?>)[\r\n]+/g,"$1").replace(/(?:[\r\n]+[ \t]*)+/g," "))}i=i}else{i=[];for(n=n.firstChild;n;n=n.nextSibling)b(n,i);i=i.join("")}i=i.replace(/(?:\r\n?|\n)$/,""),m={f:i,e:h,b:g},k(m);if(g=m.a){h=m.b;if("XMP"===h.tagName){i=document.createElement("PRE");for(n=0;n<h.attributes.length;++n)o=h.attributes[n],o.specified&&(o.name.toLowerCase()==="class"?i.className=o.value:i.setAttribute(o.name,o.value));i.innerHTML=g,h.parentNode.replaceChild(i,h)}else h.innerHTML=g}}}}l<f.length?setTimeout(d,250):c&&c()}for(var e=[document.getElementsByTagName("pre"),document.getElementsByTagName("code"),document.getElementsByTagName("xmp")],f=[],g=0;g<e.length;++g)for(var h=0,i=e[g].length;h<i;++h)f.push(e[g][h]);e=null;var j=Date;j.now||(j={now:function(){return(new Date).getTime()}});var l=0,m;d()},window.PR={combinePrefixPatterns:c,createSimpleLexer:f,registerLangHandler:i,sourceDecorator:g,PR_ATTRIB_NAME:"atn",PR_ATTRIB_VALUE:"atv",PR_COMMENT:n,PR_DECLARATION:"dec",PR_KEYWORD:m,PR_LITERAL:p,PR_NOCODE:t,PR_PLAIN:r,PR_PUNCTUATION:q,PR_SOURCE:s,PR_STRING:l,PR_TAG:"tag",PR_TYPE:o}}(),PR.registerLangHandler(PR.createSimpleLexer([["pln",/^[ \t\r\n\f]+/,null," 	\r\n\f"]],[["str",/^\"(?:[^\n\r\f\\\"]|\\(?:\r\n?|\n|\f)|\\[\s\S])*\"/,null],["str",/^\'(?:[^\n\r\f\\\']|\\(?:\r\n?|\n|\f)|\\[\s\S])*\'/,null],["lang-css-str",/^url\(([^\)\"\']*)\)/i],["kwd",/^(?:url|rgb|\!important|@import|@page|@media|@charset|inherit)(?=[^\-\w]|$)/i,null],["lang-css-kw",/^(-?(?:[_a-z]|(?:\\[0-9a-f]+ ?))(?:[_a-z0-9\-]|\\(?:\\[0-9a-f]+ ?))*)\s*:/i],["com",/^\/\*[^*]*\*+(?:[^\/*][^*]*\*+)*\//],["com",/^(?:<!--|--\>)/],["lit",/^(?:\d+|\d*\.\d+)(?:%|[a-z]+)?/i],["lit",/^#(?:[0-9a-f]{3}){1,2}/i],["pln",/^-?(?:[_a-z]|(?:\\[\da-f]+ ?))(?:[_a-z\d\-]|\\(?:\\[\da-f]+ ?))*/i],["pun",/^[^\s\w\'\"]+/]]),["css"]),PR.registerLangHandler(PR.createSimpleLexer([],[["kwd",/^-?(?:[_a-z]|(?:\\[\da-f]+ ?))(?:[_a-z\d\-]|\\(?:\\[\da-f]+ ?))*/i]]),["css-kw"]),PR.registerLangHandler(PR.createSimpleLexer([],[["str",/^[^\)\"\']+/]]),["css-str"]),KISSY.add("gallery/form/1.2/uploader/plugins/ajbridge/ajbridge",function(a,b){function h(d,i,j){d=d.replace(c,""),i=b._normalize(i||{});var k=this,l=c+d,m=function(b){if(b.status<1){k.fire("failed",{data:b});return}a.mix(k,b),(!b.dynamic||!i.src)&&k.activate()};i.id=i.id||a.guid(e),h.instances[i.id]=k,i.src&&(i.params.allowscriptaccess="always",i.params.flashvars=a.merge(i.params.flashvars,{jsEntry:g,swfID:i.id})),j?k.__args=[l,i,m]:a.later(b.add,f,!1,b,[l,i,m])}var c="#",d="1.0.15",e="ks-ajb-",f=100,g="KISSY.AJBridge.eventHandler";return a.mix(h,{version:d,instances:{},eventHandler:function(a,b){var c=h.instances[a];c&&c.__eventHandler(a,b)},augment:function(b,c){a.isString(c)&&(c=[c]);if(!a.isArray(c))return;a.each(c,function(c){b.prototype[c]=function(){try{return this.callSWF(c,a.makeArray(arguments))}catch(b){this.fire("error",{message:b})}}})}}),a.augment(h,a.EventTarget,{init:function(){if(!this.__args)return;b.add.apply(b,this.__args),this.__args=null,delete this.__args},__eventHandler:function(b,c){var d=this,e=c.type;c.id=b;switch(e){case"log":a.log(c.message);break;default:d.fire(e,c)}},callSWF:function(a,b){var c=this;b=b||[];try{if(c.swf[a])return c.swf[a].apply(c.swf,b)}catch(d){var e="";return b.length!==0&&(e="'"+b.join("','")+"'"),(new Function("self","return self.swf."+a+"("+e+");"))(c)}}}),h.augment(h,["activate","getReady","getCoreVersion"]),window.AJBridge=a.AJBridge=h,h},{requires:["flash"]}),KISSY.add("gallery/form/1.2/uploader/plugins/ajbridge/uploader",function(a,b,c){function d(b,c){c=c||{};var e={};a.each(["ds","dsp","btn","hand"],function(a){a in c&&(e[a]=c[a])}),c.params=c.params||{},c.params.flashvars=a.merge(c.params.flashvars,e),d.superclass.constructor.call(this,b,c)}return a.extend(d,c),c.augment(d,["setFileFilters","filter","setAllowMultipleFiles","multifile","browse","upload","uploadAll","cancel","getFile","removeFile","lock","unlock","setBtnMode","useHand","clear"]),d.version="1.0.1",c.Uploader=d,c.Uploader},{requires:["flash","./ajbridge"]}),KISSY.add("gallery/form/1.2/uploader/plugins/filedrop/filedrop",function(a,b,c){var d="",e=b.all,f=a.UA,g=function(a){var b=this;g.superclass.constructor.call(b,a),b.set("mode",h())},h=function(){if(f.webkit>=7||f.firefox>=3.6)return"supportDrop";if(f.ie)return"notSupportDropIe";if(f.webkit<7||f.firefox<3.6)return"notSupportDrop"};return a.mix(g,{event:{AFTER_DROP:"afterdrop"}}),a.extend(g,c,{render:function(){var b=this,c=b.get("mode"),d=b.get("uploader"),e;if(d.get("type")=="flash")return a.log("flash\u4e0a\u4f20\u65b9\u5f0f\u4e0d\u652f\u6301\u62d6\u62fd\uff01"),b.set("isSupport",!1),!1;if(c!="supportDrop")return a.log("\u8be5\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u62d6\u62fd\u4e0a\u4f20\uff01"),b.set("isSupport",!1),!1;if(!d)return a.log("\u7f3a\u5c11Uploader\u7684\u5b9e\u4f8b\uff01"),!1;e=b._createDropArea(),e.length&&e.on("click",b._clickHandler,b),d.on("afterDisabledChange",function(a){b[a.newVal&&"hide"||"show"]()}),b.fire("afterRender",{buttonTarget:b.get("buttonWrap")})},show:function(){var a=this,b=a.get("dropContainer");b.show()},hide:function(){var a=this,b=a.get("dropContainer");b.hide()},reset:function(){},_createDropArea:function(){var b=this,c=e(b.get("target")),d=b.get("mode"),f=a.substitute(b.get("tpl")[d],{name:b.get("name")}),g=e(f),h=g.all(".J_ButtonWrap");return g.appendTo(c),g.on("dragover",function(a){a.stopPropagation(),a.preventDefault()}),g.on("drop",function(a){a.stopPropagation(),a.preventDefault(),b._dropHandler(a)}),b.set("dropContainer",g),b.set("buttonWrap",h),b._setStyle(),g},_setStyle:function(){var a=this,b=a.get("dropContainer");if(!b.length)return!1;b.parent().css("position","relative"),b.css({position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"1000"})},_clickHandler:function(a){var b=this,c=e(a.target),d=b.get("uploader"),f=d.get("button"),g=f.get("fileInput");g.fire("click")},_dropHandler:function(b){var c=this,e=g.event,f=b.originalEvent.dataTransfer.files,h=[],i=c.get("uploader");if(!f.length||i==d)return!1;a.each(f,function(b){a.isObject(b)&&h.push({name:b.name,type:b.type,size:b.size,data:b})}),c.fire(e.AFTER_DROP,{files:h}),i._select({files:h})},_setDisabled:function(){}},{ATTRS:{target:{value:d},uploader:{value:d},dropContainer:{value:d},isSupport:{value:!0},tpl:{value:{supportDrop:'<div class="drop-wrapper"><p>\u76f4\u63a5\u62d6\u62fd\u56fe\u7247\u5230\u8fd9\u91cc\uff0c</p><p class="J_ButtonWrap">\u6216\u8005</p></div>',notSupportDropIe:'<div class="drop-wrapper"><p>\u60a8\u7684\u6d4f\u89c8\u5668\u53ea\u652f\u6301\u4f20\u7edf\u7684\u56fe\u7247\u4e0a\u4f20\uff0c</p><p class="suggest J_ButtonWrap">\u63a8\u8350\u4f7f\u7528chrome\u6d4f\u89c8\u5668\u6216firefox\u6d4f\u89c8\u5668</p></div>',notSupportDrop:'<div class="drop-wrapper"><p>\u60a8\u7684\u6d4f\u89c8\u5668\u53ea\u652f\u6301\u4f20\u7edf\u7684\u56fe\u7247\u4e0a\u4f20\uff0c</p><p class="suggest J_ButtonWrap">\u63a8\u8350\u5347\u7ea7\u60a8\u7684\u6d4f\u89c8\u5668</p></div>'}},name:{value:"",setter:function(a){}},disabled:{value:!1,setter:function(a){return this._setDisabled(a),a}},cls:{disabled:"drop-area-disabled"}}}),g},{requires:["node","base"]}),KISSY.add("gallery/form/1.2/uploader/plugins/preview/preview",function(a,b,c){function i(){var b="";if(typeof window.FileReader=="undefined")switch(a.UA.shell){case"firefox":b="domfile";break;case"ie":switch(a.UA.ie){case 6:b="simple";break;default:b="filter"}}else b="html5";return b}function j(a,b,c,d){return a?(f!="filter"?a.src=b||h:(a.src=h,b&&(b=b.replace(/[)'"%]/g,function(a){return escape(escape(a))}),a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src='"+b+"')",a.zoom=1)),!0):!1}function k(b){var c=this,d={maxWidth:40,maxHeight:40};c.config=a.mix(d,b),a.log(e+"Preview initialized. The preview mode is "+f)}var d=document,e="[Plugin: Preview] ",f=i(),g={check:"check",success:"success",showed:"showed",error:"error"},h=a.UA.ie<8?"http://a.tbcdn.cn/p/fp/2011a/assets/space.gif":"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";return a.augment(k,a.EventTarget,{preview:function(c,h){c=b.get(c),h=b.get(h);var i=this,k=function(){i.fire(g.getData,{data:i.data,mode:f}),h&&(j(h,i.data),i.fire(g.showed,{img:h}))};i.data=undefined;if(c){a.log(e+"One file selected. Getting data...");switch(f){case"domfile":i.data=c.files[0].getAsDataURL();break;case"filter":c.select();try{i.data=d.selection.createRange().text}catch(l){a.log(e+"Get image data error, the error is: "),a.log(l,"dir")}finally{d.selection.empty()}i.data||(i.data=c.value);break;case"html5":var m=new FileReader;m.onload=function(a){i.data=a.target.result,k()},m.onerror=function(b){a.log(e+"File Reader Error. Your browser may not fully support html5 file api","warning"),i.fire(g.error)},c.files&&m.readAsDataURL(c.files[0]);break;case"simple":default:i.data=c.value}i.data?k():f!="html5"&&(a.log(e+"Retrive Data error."),j(h),i.fire(g.error))}else a.log(e+"File Input Element does not exists.");return i.data}}),k},{requires:["dom","event"]}),KISSY.add("gallery/form/1.2/uploader/plugins/progressBar/progressBar",function(a,b,c){function l(b,c){var d=this;c=a.merge({wrapper:e(b)},c),l.superclass.constructor.call(d,c)}var d="",e=b.all,f="progressbar",g="role",h="aria-valuemin",i="aria-valuemax",j="aria-valuenow",k="data-value";return a.mix(l,{tpl:{DEFAULT:'<div class="ks-progress-bar-value" data-value="{value}"></div>'},cls:{PROGRESS_BAR:"ks-progress-bar",VALUE:"ks-progress-bar-value"},event:{RENDER:"render",CHANGE:"change",SHOW:"show",HIDE:"hide"}}),a.extend(l,c,{render:function(){var a=this,b=a.get("wrapper"),c=a.get("width");if(!b.length)return!1;b.addClass(l.cls.PROGRESS_BAR).width(c),a._addAttr(),!a.get("visible")&&a.hide(),a.set("bar",a._create()),a.fire(l.event.RENDER)},show:function(){var a=this,b=a.get("wrapper");b.fadeIn(a.get("duration"),function(){a.set("visible",!0),a.fire(l.event.SHOW,{visible:!0})})},hide:function(){var a=this,b=a.get("wrapper");b.fadeOut(a.get("duration"),function(){a.set("visible",!1),a.fire(l.event.HIDE,{visible:!1})})},_create:function(){var b=this,c=b.get("wrapper"),d=b.get("value"),f=b.get("tpl"),g=a.substitute(f,{value:d});return c.html(""),e(g).appendTo(c)},_addAttr:function(){var a=this,b=a.get("wrapper"),c=a.get("value");return b.attr(g,f),b.attr(h,0),b.attr(i,100),b.attr(j,c),a}},{ATTRS:{wrapper:{value:d},bar:{value:d},width:{value:100},value:{value:0,setter:function(a){var b=this,c=b.get("wrapper"),d=b.get("bar"),e=b.get("speed"),f;return a>100&&(a=100),a<0&&(a=0),f=c.width()*(a/100),d.animate({width:f+"px"},e,"none",function(){c.attr(j,a),d.attr(k,a),b.fire(l.event.CHANGE,{value:a,width:f})}),a}},visible:{value:!0},duration:{value:.3},tpl:{value:l.tpl.DEFAULT},speed:{value:.2}}}),l},{requires:["node","base"]}),KISSY.add("gallery/form/1.2/uploader/queue",function(a,b,c){function g(a){var b=this;g.superclass.constructor.call(b,a)}var d="",e=b.all,f="[uploader-queue]:";return a.mix(g,{tpl:{DEFAULT:'<li id="queue-file-{id}" class="clearfix" data-name="{name}"><div class="f-l sprite file-icon"></div><div class="f-l">{name}</div><div class="f-l file-status J_FileStatus"></div></li>'},event:{ADD:"add",ADD_FILES:"addFiles",REMOVE:"remove",CLEAR:"clear",FILE_STATUS:"statusChange",UPDATE_FILE:"updateFile",RESTORE:"restore"},status:{WAITING:"waiting",START:"start",PROGRESS:"progress",SUCCESS:"success",CANCEL:"cancel",ERROR:"error",RESTORE:"restore"},cls:{QUEUE:"ks-uploader-queue"},hook:{STATUS:".J_FileStatus"},FILE_ID_PREFIX:"file-"}),a.extend(g,c,{add:function(b,c){var d=this,e={};return b.length>0?(e=[],a.each(b,function(a){e.push(d._addFile(a))})):e=d._addFile(b),c&&c.call(d),e},_addFile:function(b,c){if(!a.isObject(b))return a.log(f+"_addFile()\u53c2\u6570file\u4e0d\u5408\u6cd5\uff01"),!1;var d=this,e=d._setAddFileData(b),h=d.getFileIndex(e.id),i=d.get("fnAdd");return a.isFunction(i)&&(e=i(h,e)),d.fire(g.event.ADD,{index:h,file:e,uploader:d.get("uploader")}),c&&c.call(d,h,e),e},remove:function(b,c){var d=this,e=d.get("files"),h;return a.isString(b)&&(b=d.getFileIndex(b)),h=e[b],a.isObject(h)?(e=a.filter(e,function(a,c){return c!==b}),d.set("files",e),d.fire(g.event.REMOVE,{index:b,file:h}),c&&c.call(d,b,h),h):(a.log(f+"remove()\u4e0d\u5b58\u5728index\u4e3a"+b+"\u7684\u6587\u4ef6\u6570\u636e"),!1)},clear:function(){function c(){b=a.get("files");if(!b.length)return a.fire(g.event.CLEAR),!1;a.remove(0,function(){c()})}var a=this,b;c()},fileStatus:function(b,c,d){if(!a.isNumber(b))return!1;var e=this,f=e.getFile(b),h=e.get("theme"),i,j;return f?(i=f.status,c?i==c?e:(e.updateFile(b,{status:c}),j="_"+c+"Handler",h&&a.isFunction(h[j])&&(d=a.merge({uploader:e.get("uploader"),index:b,file:f,id:f.id},d),h[j].call(h,d)),e.fire(g.event.FILE_STATUS,{index:b,status:c,args:d,file:f}),e):i):!1},getFile:function(b){if(!a.isNumber(b))return!1;var c=this,d=c.get("files"),e=d[b];return a.isPlainObject(e)||(a.log("getFile():\u6587\u4ef6\u6570\u636e\u4e3a\u7a7a\uff01"),e={}),e},getFileIndex:function(b){var c=this,d=c.get("files"),e=-1;return a.each(d,function(a,c){if(a.id==b)return e=c,!0}),e},updateFile:function(b,c){if(!a.isNumber(b))return!1;if(!a.isObject(c))return a.log(f+"updateFile()\u7684data\u53c2\u6570\u6709\u8bef\uff01"),!1;var d=this,e=d.get("files"),h=d.getFile(b);return h?(a.mix(h,c),e[b]=h,d.set("files",e),d.fire(g.event.UPDATE_FILE,{index:b,file:h}),h):!1},getIndexs:function(b){var c=this,d=c.get("files"),e,f=[];return d.length?(a.each(d,function(c,d){a.isObject(c)&&(e=c.status,e==b&&f.push(d))}),f):f},getFiles:function(b){var c=this,d=c.get("files"),e=[];return d.length?(a.each(d,function(a){a&&a.status==b&&e.push(a)}),e):[]},_setAddFileData:function(b){var c=this,e=c.get("files");return a.isObject(b)?(b.id||(b.id=a.guid(g.FILE_ID_PREFIX)),b.size&&(b.textSize=a.convertByteSize(b.size)),b.status=d,e.push(b),b):(a.log(f+"_updateFileData()\u53c2\u6570file\u4e0d\u5408\u6cd5\uff01"),!1)}},{ATTRS:{fnAdd:{value:d},files:{value:[]},uploader:{value:d},theme:{value:d}}}),g},{requires:["node","base"]}),KISSY.add("gallery/form/1.2/uploader/theme",function(a,b,c){function g(a){var b=this;g.superclass.constructor.call(b,a)}var d="",e=b.all,f={BUTTON:"-button",QUEUE:"-queue"};return a.extend(g,c,{render:function(){var a=this;a._LoaderCss(function(){a._addThemeCssName(),a.fire("render")})},afterUploaderRender:function(a){},_getStatusWrapper:function(a){return a&&a.children(".J_FileStatus")||e("")},displayFile:function(a,b,c){var d=this,e=d.get("duration");if(!b||!b.length)return!1;b[a&&"fadeIn"||"fadeOut"](e,function(){c&&c.call(d)})},_waitingHandler:function(a){},_startHandler:function(a){},_progressHandler:function(a){},_successHandler:function(a){},_errorHandler:function(a){},_restoreHandler:function(a){},_UploaderRender:function(a){var b=this;b._initQueue(),b._loadPlugins(a)},_addThemeCssName:function(){var a=this,b=a.get("name"),c=e(a.get("queueTarget")),g=e(a.get("buttonTarget"));if(b==d)return!1;c.length&&c.addClass(b+f.QUEUE),g.addClass(b+f.BUTTON)},_initQueue:function(){var a=this,b=a.get("queue");return b.set("fnAdd",function(b,c){return a._addCallback(b,c)}),b.set("theme",a),b.on("add",a._addFileHandler,a),b.on("remove",a._removeFileHandler,a),b.on("statusChange",function(b){a._setStatusVisibility(b)}),b},_LoaderCss:function(b){var c=this,e=c.get("cssUrl");if(e==d)return b.call(c),!1;a.use(e,function(){a.log(e+"\u52a0\u8f7d\u6210\u529f\uff01"),b.call(c)})},_addCallback:function(a,b){var c=this,d=c.get("queue"),e=c._appendFileDom(b);return d.updateFile(a,{target:e,statusWrapper:c._getStatusWrapper(e)}),d.fileStatus(a,"waiting"),c.displayFile(!0,e),c._bindTriggerEvent(a,b),d.getFile(a)},_removeFileHandler:function(a){var b=this,c=a.file;b.displayFile(!1,c.target)},_bindTriggerEvent:function(b,c){var d=this,f=d.get("queue"),g=d.get("uploader"),h=c.id,i=e(".J_Upload_"+h),j=e(".J_Cancel_"+h),k=e(".J_Del_"+h);i.on("click",function(c){c.preventDefault();if(!a.isObject(g))return!1;g.upload(b)}),j.on("click",function(a){a.preventDefault(),g.cancel(b)}),k.on("click",function(a){a.preventDefault(),f.remove(h)})},_setStatusVisibility:function(b){var c=b.file.statusWrapper,d,e=b.file,f=e.status;if(!c||!c.length)return a.log("\u72b6\u6001\u5bb9\u5668\u5c42\u4e0d\u5b58\u5728\uff01"),!1;d=c.children(".status"),d.hide(),c.children("."+f+"-status").show()},_appendFileDom:function(b){var c=this,d=c.get("fileTpl"),f=e(c.get("queueTarget")),g;return f.length?(g=a.substitute(d,b),e(g).hide().appendTo(f).data("data-file",b)):!1},_loadPlugins:function(b){var c=this,d=c.get("plugins"),e=c.get("oPlugin"),f="gallery/form/1.2/uploader/plugins/",g=[];if(!d.length)return b&&b.call(c,e),!1;a.each(d,function(a){g.push(f+a+"/"+a)}),a.use(g.join(","),function(){a.each(arguments,function(a,b){b>=1&&(e[d[b-1]]=a)}),c.set("oPlugin",e),b&&b.call(c,e)})}},{ATTRS:{name:{value:d},cssUrl:{value:d},fileTpl:{value:d},plugins:{value:[]},oPlugin:{value:{}},queueTarget:{value:d},duration:{value:.3},queue:{value:d},uploader:{value:d},button:{value:d},auth:{value:d}}}),g},{requires:["node","base"]}),KISSY.add("gallery/form/1.2/uploader/type/ajax",function(a,b,c){function g(a){var b=this;g.superclass.constructor.call(b,a)}var d="",e=b.all,f="[uploader-AjaxType]:";return a.mix(g,{event:a.merge(c.event,{PROGRESS:"progress"})}),a.extend(g,c,{upload:function(b){if(!b)return a.log(f+"upload()\uff0cfileData\u53c2\u6570\u6709\u8bef\uff01"),!1;var c=this;return c._setFormData(),c._addFileData(b),c.send(),c},stop:function(){var b=this,c=b.get("xhr");return a.isObject(c)?(c.abort(),b.fire(g.event.STOP),b):(a.log(f+"stop()\uff0cio\u503c\u9519\u8bef\uff01"),!1)},send:function(){var b=this,c=b.get("action"),d=b.get("formData"),e=new XMLHttpRequest;return e.upload.addEventListener("progress",function(a){b.fire(g.event.PROGRESS,{loaded:a.loaded,total:a.total})}),e.onload=function(c){var d={};try{d=a.JSON.parse(e.responseText)}catch(h){a.log(f+"ajax\u8fd4\u56de\u7ed3\u679c\u96c6responseText\u683c\u5f0f\u4e0d\u5408\u6cd5\uff01")}b.fire(g.event.SUCCESS,{result:d})},e.open("POST",c,!0),d.append("type","ajax"),e.send(d),b._setFormData(),b.set("xhr",e),b},_setFormData:function(){var b=this;try{b.set("formData",new FormData),b._processData()}catch(c){a.log(f+"something error when reset FormData."),a.log(c,"dir")}},_processData:function(){var b=this,c=b.get("data"),d=b.get("formData");a.each(c,function(a,b){d.append(b,a)}),b.set("formData",d)},_addFileData:function(b){if(!a.isObject(b))return a.log(f+"_addFileData()\uff0cfile\u53c2\u6570\u6709\u8bef\uff01"),!1;var c=this,d=c.get("formData"),e=c.get("fileDataName");d.append(e,b),c.set("formData",d)}},{ATTRS:{formData:{value:d},ajaxConfig:{value:{type:"post",processData:!1,cache:!1,dataType:"json",contentType:!1}},xhr:{value:d},fileDataName:{value:d},form:{value:{}},fileInput:{value:d}}}),g},{requires:["node","./base"]}),KISSY.add("gallery/form/1.2/uploader/type/base",function(a,b,c){function f(a){var b=this;f.superclass.constructor.call(b,a)}var d="",e=b.all;return a.mix(f,{event:{START:"start",STOP:"stop",SUCCESS:"success",ERROR:"error"}}),a.extend
(f,c,{upload:function(){},stop:function(){}},{ATTRS:{action:{value:d},data:{value:{}}}}),f},{requires:["node","base"]}),KISSY.add("gallery/form/1.2/uploader/type/flash",function(a,b,c,d){function h(a){var b=this;h.superclass.constructor.call(b,a),b.isHasCrossdomain(),b._init()}var e="",f=b.all,g="[uploader-FlashType]:";return a.mix(h,{event:a.merge(c.event,{SWF_READY:"swfReady",PROGRESS:"progress"})}),a.extend(h,c,{_init:function(){var b=this,c=b.get("swfUploader");if(!c)return a.log(g+"swfUploader\u5bf9\u8c61\u4e3a\u7a7a\uff01"),!1;c.on("contentReady",function(a){b.fire(h.event.SWF_READY)},b),c.on("uploadStart",b._uploadStartHandler,b),c.on("uploadProgress",b._uploadProgressHandler,b),c.on("uploadCompleteData",b._uploadCompleteDataHandler,b),c.on("uploadError",b._uploadErrorHandler,b)},upload:function(b){var c=this,d=c.get("swfUploader"),e=c.get("action"),f="POST",g=c.get("data"),h=c.get("fileDataName");return h||(h="Filedata"),c.set("uploadingId",b),a.mix(g,{type:"flash"}),d.upload(b,e,f,g,h),c},stop:function(){var a=this,b=a.get("swfUploader"),c=a.get("uploadingId");return c!=e&&(b.cancel(c),a.fire(h.event.STOP,{id:c})),a},_uploadStartHandler:function(a){var b=this;b.fire(h.event.START,{file:a.file})},_uploadProgressHandler:function(b){var c=this;a.mix(b,{loaded:b.bytesLoaded,total:b.bytesTotal}),a.log(g+"\u5df2\u7ecf\u4e0a\u4f20\u5b57\u8282\u6570\u4e3a\uff1a"+b.bytesLoaded),c.fire(h.event.PROGRESS,{loaded:b.loaded,total:b.total})},_uploadCompleteDataHandler:function(b){var c=this,d;try{d=JSON.parse(b.data)}catch(f){a.log(g+"json\u6570\u636e\u683c\u5f0f\u4e0d\u5408\u6cd5\uff01"),c.fire(h.event.ERROR,{msg:"\u4e0d\u662f\u5408\u6cd5\u7684json\u6570\u636e"})}a.log(g+"\u670d\u52a1\u5668\u7aef\u8f93\u51fa\uff1a"+d),c.set("uploadingId",e),c.fire(h.event.SUCCESS,{result:d})},_uploadErrorHandler:function(a){var b=this;b.set("uploadingId",e),b.fire(h.event.ERROR,{msg:a.msg})},isHasCrossdomain:function(){var b=location.hostname;a.io({url:"http://"+b+"/crossdomain.xml",dataType:"xml",error:function(){a.log("\u7f3a\u5c11crossdomain.xml\u6587\u4ef6\u6216\u8be5\u6587\u4ef6\u4e0d\u5408\u6cd5\uff01")}})}},{ATTRS:{action:{value:e,getter:function(b){var c=/^http/;if(!c.test(b)){var d=location.href,e=d.split("/"),f;f=a.filter(e,function(a,b){return b<e.length-1}),b=f.join("/")+"/"+b}return b}},swfUploader:{value:e},uploadingId:{value:e}}}),h},{requires:["node","./base"]}),KISSY.add("gallery/form/1.2/uploader/type/iframe",function(a,b,c){function h(a){var b=this;h.superclass.constructor.call(b,a)}var d="",e=b.all,f="[uploader-iframeType]:",g="ks-uploader-iframe-";return a.mix(h,{tpl:{IFRAME:'<iframe src="javascript:false;" name="{id}" id="{id}" border="no" width="1" height="1" style="display: none;" />',FORM:'<form method="post" enctype="multipart/form-data" action="{action}" target="{target}" style="visibility: hidden;">{hiddenInputs}</form>',HIDDEN_INPUT:'<input type="hidden" name="{name}" value="{value}" />'},event:a.mix(c.event,{CREATE:"create",REMOVE:"remove"})}),a.extend(h,c,{upload:function(b){var c=this,d=e(b),g;if(!d.length)return!1;c.fire(h.event.START,{input:d}),c.set("fileInput",d),c._create(),g=c.get("form");if(!g)return a.log(f+"form\u8282\u70b9\u4e0d\u5b58\u5728\uff01"),!1;g.getDOMNode().submit()},stop:function(){var a=this,b=a.get("iframe");return b.attr("src",'javascript:"<html></html>";'),a._remove(),a.fire(h.event.STOP),a.fire(h.event.ERROR,{status:"abort",msg:"\u4e0a\u4f20\u5931\u8d25\uff0c\u539f\u56e0\uff1aabort"}),a},dataToHidden:function(b){if(!a.isObject(b)||a.isEmptyObject(b))return"";var c=this,e=d,f=c.get("tpl"),g=f.HIDDEN_INPUT;if(!a.isString(g))return"";for(var h in b)e+=a.substitute(g,{name:h,value:b[h]});return e},_createIframe:function(){var b=this,c=g+a.guid(),d=b.get("tpl"),h=d.IFRAME,i=b.get("iframe"),j,k;return a.isEmptyObject(i)?a.isString(h)?a.isString(c)?(j=a.substitute(d.IFRAME,{id:c}),k=e(j),k.on("load",b._iframeLoadHandler,b),e("body").append(k),b.set("id",c),b.set("iframe",k),k):(a.log(f+"id\u5fc5\u987b\u5b58\u5728\u4e14\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\uff01"),!1):(a.log(f+"iframe\u7684\u6a21\u677f\u4e0d\u5408\u6cd5\uff01"),!1):i},_iframeLoadHandler:function(b){var c=this,e=b.target,g=h.event.ERROR,i=e.contentDocument||window.frames[e.id].document,j;if(!i||!i.body)return c.fire(g,{msg:"\u670d\u52a1\u5668\u7aef\u8fd4\u56de\u6570\u636e\u6709\u95ee\u9898\uff01"}),!1;j=i.body.innerHTML,a.log(f+"\u670d\u52a1\u5668\u7aef\u8f93\u51fa:"+j);if(j==d)return!1;try{j=JSON.parse(j)}catch(k){a.log(f+"json\u6570\u636e\u683c\u5f0f\u4e0d\u5408\u6cd5\uff01"),c.fire(g,{msg:"\u6570\u636e\uff1a"+j+"\u4e0d\u662f\u5408\u6cd5\u7684json\u6570\u636e"})}c.fire(h.event.SUCCESS,{result:j}),c._remove()},_createForm:function(){var b=this,c=b.get("id"),d=b.get("tpl"),g=d.FORM,h=b.get("data"),i=b.get("action"),j=b.get("fileInput"),k,l,m;return a.isString(g)?a.isString(i)?(k=b.dataToHidden(h),k+=b.dataToHidden({type:"iframe"}),m=a.substitute(g,{action:i,target:c,hiddenInputs:k}),l=e(m).append(j),e("body").append(l),b.set("form",l),l):(a.log(f+"action\u53c2\u6570\u4e0d\u5408\u6cd5\uff01"),!1):(a.log(f+"form\u6a21\u677f\u4e0d\u5408\u6cd5\uff01"),!1)},_create:function(){var a=this,b=a._createIframe(),c=a._createForm();a.fire(h.event.CREATE,{iframe:b,form:c})},_remove:function(){var b=this,c=b.get("form");if(!c)return a.log(f+"form\u8282\u70b9\u4e0d\u5b58\u5728\uff01"),!1;c.remove(),b.reset("form"),b.fire(h.event.REMOVE,{form:c})}},{ATTRS:{tpl:{value:h.tpl},id:{value:g+a.guid()},iframe:{value:{}},form:{value:{}},fileInput:{value:d}}}),h},{requires:["node","./base"]}),KISSY.add("gallery/form/1.2/uploader/urlsInput",function(a,b,c){function g(a,b){var c=this;g.superclass.constructor.call(c,b),c.set("wrapper",e(a))}var d="",e=b.all,f="[uploader-urlsInput]:";return a.mix(g,{TPL:'<input type="hidden" id="{name}" name="{name}" value="{value}" />'}),a.extend(g,c,{render:function(){var b=this,c=b.get("wrapper"),d=b.get("name"),g=document.getElementsByName(d)[0];return a.isObject(c)?(g?(a.log(f+"urls input found"),b.set("input",e(g))):b._create(),b):(a.log(f+"container\u53c2\u6570\u4e0d\u5408\u6cd5\uff01"),!1)},add:function(b){if(!a.isString(b))return a.log(f+"add()\u7684url\u53c2\u6570\u4e0d\u5408\u6cd5\uff01"),!1;var c=this,e=c.get("urls"),g=c.isExist(b);return e[0]==d&&(e=[]),g?(a.log(f+"add()\uff0c\u6587\u4ef6\u8def\u5f84\u5df2\u7ecf\u5b58\u5728\uff01"),c):(e.push(b),c.set("urls",e),c._val(),c)},remove:function(b){if(!b)return!1;var c=this,d=c.get("urls"),e=c.isExist(b),g=new RegExp(b);return e?(d=a.filter(d,function(a){return!g.test(a)}),c.set("urls",d),c._val(),d):(a.log(f+"remove()\uff0c\u4e0d\u5b58\u5728\u8be5\u6587\u4ef6\u8def\u5f84\uff01"),!1)},parse:function(){var b=this,c=b.get("input");if(c){var d=e(c).val(),g=b.get("split"),h;return h=d.split(g),b.set("urls",h),h}return a.log(f+"cannot find urls input."),[]},_val:function(){var a=this,b=a.get("urls"),c=a.get("input"),d=a.get("split"),e=b.join(d);return c.val(e),e},isExist:function(b){var c=this,d=!1,e=c.get("urls"),f=new RegExp(b);return e.length?(a.each(e,function(a){if(f.test(a))return d=!0}),d):!1},_create:function(){var b=this,c=b.get("wrapper"),d=b.get("tpl"),g=b.get("name"),h=b.get("urls"),i;return!c||c.length<=0?(a.log(f+"UrlsInput container not specified!","warn"),!1):!a.isString(d)||!a.isString("name")?(a.log(f+"_create()\uff0ctpl\u548cname\u5c5e\u6027\u4e0d\u5408\u6cd5\uff01"),!1):(i=e(a.substitute(d,{name:g,value:h})),c.append(i),b.set("input",i),a.log(f+"input created."),i)}},{ATTRS:{name:{value:d},urls:{value:[]},tpl:{value:g.TPL},split:{value:",",setter:function(a){var b=this;return b._val(),a}},input:{value:d},wrapper:{value:d}}}),g},{requires:["node","base"]});