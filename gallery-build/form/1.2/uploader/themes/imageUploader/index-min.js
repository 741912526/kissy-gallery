KISSY.add("gallery/form/1.2/uploader/themes/imageUploader/index",function(d,c,b){var f="",e=c.all;function a(h){var g=this;a.superclass.constructor.call(g,h)}d.extend(a,b,{afterUploaderRender:function(i){var h=this,g=h.get("queue");h._maxHideBtn(i);h._renderFiledrop();g.on("add",h._addFileHandler,h)},_addFileHandler:function(k){var i=this,j=k.file,h=j.target,g=e(".J_Del_"+j.id),l=e(".J_Mask_"+j.id);h.on("mouseover mouseout",function(m){if(m.type=="mouseover"){g.show();l.show()}else{g.hide();l.hide()}});g.data("data-file",j);g.on("click",i._delHandler,i)},_getStatusWrapper:function(g){return g.children(".J_FileStatus")},_renderFiledrop:function(){var i=this,j=i.get("button"),k=j.get("target"),h=i.get("oPlugin").filedrop,g;if(!h){return false}g=new h({target:k,uploader:this.get("uploader"),tpl:{supportDrop:'<div class="drop-wrapper"></div>'}});g.render();return g},_waitingHandler:function(g){},_startHandler:function(m){var n=this,j=m.uploader,l=m.index,k=n.get("queue"),g=j.get("type"),h=e(".J_ProgressBar_"+m.id);if(g=="ajax"||g=="flash"){var o=n.get("oPlugin").progressBar,i;if(o){i=new o(h);i.render();n.set("progressBar",i)}k.updateFile(l,{progressBar:i})}},_progressHandler:function(j){var h=j.file,g=j.loaded,i=j.total,l=Math.ceil((g/i)*100),k=h.progressBar;if(!k){return false}k.set("value",l)},_successHandler:function(j){var h=this,i=j.file,g=i.result;h._setCount();if(g){h._changeImageSrc(j.id,g)}h._setDisplayMsg(false,j.file)},_errorHandler:function(h){var g=this,i=h.msg,j=h.id;e(".J_ErrorMsg_"+j).html(i);g._setDisplayMsg(true,h.file);d.log(i)},_setCount:function(){var o=this,h=e(o.get("elCount")),k=o.getFilesLen(),g=o.get("auth"),j=o.get("uploader"),i=j.get("button");if(!g){return false}var n=g.get("rules"),m=n.max;if(!m){return false}if(k<m[0]){i.show();var l=i.get("target").parent("li");if(l){l.show()}}if(h.length){h.text(m[0]-k)}},_setDisplayMsg:function(g,h){if(!h){return false}var j=e(".J_Mask_"+h.id),i=h.statusWrapper;j[g&&"show"||"hide"]();if(g){j.show();i.show()}else{j.hide();i.hide()}},_maxHideBtn:function(i){var g=this,h=g.get("auth");if(h==f){return false}h.on("error",function(l){var m=l.rule,j=i.get("button"),k=j.get("target");if(m=="max"){j.hide();var n=k.parent("li");if(n){n.hide()}}})},_delHandler:function(l){var i=this,m=i.get("uploader"),g=i.get("queue"),k=e(l.target).data("data-file"),j=g.getFileIndex(k.id),h=k.status;if(h=="start"||h=="progress"){m.cancel(j)}i._setCount()},getFilesLen:function(h){if(!h){h="success"}var i=this,g=i.get("queue"),j=g.getFiles(h);return j.length},_changeImageSrc:function(k,g){var j=g.data,h,i=e(".J_Pic_"+k);if(!d.isObject(j)){return false}h=j.url;if(i.attr("src")==f||d.UA.ie==8){i.attr("src",h)}}},{ATTRS:{name:{value:"imageUploader"},cssUrl:{value:"gallery/form/1.2/uploader/themes/imageUploader/style.css"},fileTpl:{value:'<li id="queue-file-{id}" class="clearfix" data-name="{name}"><div class="tb-pic120"><a href="javascript:void(0);"><img class="J_Pic_{id}" src="" /></a></div><div class=" J_Mask_{id} pic-mask"></div><div class="status-wrapper J_FileStatus"><div class="status waiting-status tips-upload-waiting"><p class="tips-text">等待上传，请稍候</p></div><div class="status start-status progress-status tips-uploading"><div class="J_ProgressBar_{id}"><s class="loading-icon"></s>上传中...</div></div><div class="status success-status tips-upload-success">上传成功！</div><div class="status error-status tips-upload-error"><p class="J_ErrorMsg_{id} tips-text">上传失败，请重试！</p></div></div><a class="J_Del_{id} del-pic" href="#">删除</a></li>'},plugins:{value:["progressBar","filedrop"]},elCount:{value:"#J_UploadCount"}}});return a},{requires:["node","../../theme"]});