KISSY.add("gallery/province/1.0/index",function(g){function k(a,b,c){var e=this;e.config=g.merge(m,c||{});e.selManager=new n;e.data=b;g.each(a,function(f,i){if(f=l.get(f)){e.selManager.add(f,i);o.on(f,"change",function(h){e._change(h)})}});if(e.config.autoRender==true)if(a=e.selManager.get(0)){e._render(a,c.rootid);e.selManager.get(1)&&e.focus(a[0],e.getValue(a[0]))}}function n(){var a=[];this.add=function(b,c){var e=a.length;a[e]={index:c,"0":b,data:{}};return a[e]};this.get=function(b){var c=null;
if(g.isNumber(b)&&b<=a.length)return a[b];g.each(a,function(e){if(e["0"]==b){c=e;return false}});return c}}var l=g.DOM,o=g.Event,m={autoRender:true,defval:{text:"\u8bf7\u9009\u62e9",val:""},rootid:0};g.augment(k,g.EventTarget,{getValue:function(a){return a&&a.options?a.options[a.selectedIndex]?a.options[a.selectedIndex].value:"":""},_forward:function(a,b){var c=this.selManager.get(a);if(c)if(c=this.selManager.get(c.index+1)){this._render(c,b);this._forward(c[0],this.getValue(c[0]))}},_backward:function(a,b){pid=
this.data[b]?this.data[b][1]:null;if((forwardEl=this.selManager.get(a))&&pid){var c=this.selManager.get(forwardEl.index-1),e=this.data[pid]?this.data[pid][1]:null;if(c&&pid){this._render(c,e,pid);this._backward(c[0],this.getValue(c[0]))}}},_change:function(a){a=a.target;this.selManager.get(a);this._forward(a,l.val(a))},_getData:function(a,b){var c=this,e=c.config.remote,f=[];if(!(b===-1||b===""||!a.data)){if(a.data[b])return a.data[b];var i=a.data[b]=[];if(e){if(b===0&&c.data.length>0)return;g.io({type:"POST",
url:e.url,dataType:"json",data:{parent:b},success:function(h){g.each(h.data,function(j){i.push([j[1],j[0]])});c._render(a,b)},error:function(h,j,p){g.log(d,j,p)}})}g.each(c.data,function(h,j){if(h[1]==b){i.push([j,h[0]]);f.push([j,h[0]])}});return f}},_render:function(a,b,c){var e=this.config,f=a["0"];a=this._getData(a,b)||[];if(f){f.options.length=0;if(a&&a.length>0&&e.defval)f.options[f.options.length]=new Option(e.defval.text,e.defval.val);g.each(a,function(i){f.options[f.options.length]=new Option(i[1],
i[0])});if(c)f.value=c}},focus:function(a,b){var c=this.selManager.get(a),e=this.data[b]?this.data[b][1]:null;if(e){this._render(c,e,b);this._forward(a,b);this._backward(a,b)}}});return k});
